# Authentication

## Configure client application settings

### Application settings
* Advanced settings
  * manage/add application metadata tab
    * exposed as client_metadata for use in rules
    * max 255 characters
    * can have up to 10 sets of metadata
  * device settings tab
    * IOS - add team id and app id
    * Android - add package name & key hashes
  * OAuth tab
    * white list apps and apis
      * default: allow all (empty)
    * Compliance enforcement level
      * default: none
    * Non-Verifiable Callback URI End-User Confirmation - user has to login when callbcak is non verifiable
      * default: on
    * Algorithm used to sign JWTs - RS256
      * default: RS256
    * Trust Token endpoint IP header - auth0-forwarded-for is trusted as source of IP address and used to detect brute force attacks (Reg web apps and M2M only)
      * default: off
    * OIDC Compliant - will follow strictly
      * default: on
  * Grant types tab
  * WS Federation tab
  * Certificates tab
  * Endpoints tab

### Protocols
* OAuth 2.0
* OpenID Connect
* LDAP
* JWTs
* SAML
* SCIM (System ofr cross domain identity management)
* WS-Federation - microsoft only, dictates how security tokens can be exchanged

### Refresh tokens
* Compliance with: OAuth 2.0 Security BCP
* New one issued when current refresh token is used. Old one is invalidated
  * Rotation Overlap Period - interval to allow leeway time that previous refresh token can still be used after new one is issued
* Recommends
  * automatic reuse detection
  * refresh token rotation
* SDK: supports refresh token management
* Affects flows
  * Authorization Code Flow (with/without PKCE)
  * Device Authorization Flow
  * Resource Owner Password Flow
* Lifetime settings
  * Idle
    * same as max but for when a user is not active in your application during a specified period of time
    * default: 30 days (2592,000 seconds)
    * min: 1 second
    * max: 1 year (31,557,600 seconds or 365.25 days)
    * cannot exceed max (see next)
  * max
    * after which a user must re-authenticate before being issued a new access token
    * disable then token expiry is indefinite (not applicable for browser based apps)
    * default: 1 year (31,557,600 seconds or 365.25 days) 
    * min: 1 second
    * max: 1 year (31,557,600 seconds or 365.25 days)
* Limitations
  * max determined at issuance and remains fixed during its lifetime even if max is updated
  * max can be overridden by [sessions with actions](https://auth0.com/docs/manage-users/sessions/manage-sessions-actions)
  * idle only updates with each successful refresh token exchange
  * max is changed, it will override any non-expiring refresh tokens with next exchange
  * once non-expiring refresh token is converted to expiring it cannot be reverted back again
    
## Set up single sign-on (SSO)
* Provided via an SSO Cookie representing a session for each of the following domains (if used)
  * application
  * auth server
  * IdP (social or 3rd party)
* Any issued signed tokens by one domain will be accepted by any other domain
* Availability: only via Universal login
* SDK: use checkSession to silently login using SSO (does via an iframe to allow access to Auth0 cookie)
* Protocol support: SAML, WS-Federation, OpenID Connect, AD/LDAP
* Service-provider-initiated SSO: Auth0 is SSO service provider and redirects to IdP to authenticate
* Identity-provider-initiated SSO: 3rd party IdP is SSO identity provider. Use SSO Dashboard Extension can provide multiple enterprise apps that can be enabled for SSO

## Set up single logout functionality

### Log users out of applications
* RP-initiated logout - When user logs out they are logged out of all applications
  * RP-initiated logout endpoint (/oidc/logout or /oidc/logout?federated for 3rd party IdPs also)
    * invalidates SSO cookie
    * Signs users out of all IdPs they have authenticated with
    * Requires: enable endpoint discovery and calling of oidc endpoint
* Regular logout of app (/v2/logout or /v2/logout?federated for 3rd party IdPs also)
  * if you want more
    * handle this at application level - add rule/action to log out of other applications
    * have shorter timouts on local sessions via checkSession
* Limitations
  * no validation perform on returnTo query parameter
  * federated logout with social providers is inconsistent. Some will use returnTo and some will not
  * Google/Facebook - you must set clientId and secret for these providers in dashboard for logout to work correctly
  
### Redirect users with alternative logout
* Redirect users to specific URL after logout 
  * via returnTo query parameter (must be encoded)
  * must be added to allowed logout URLs in dashboard un-encoded (comma separated, * for subdomains, and case sensitive)
  * if not client_id provided then you must set returnTo value in allowed logout at tenant level

### OIDC Back Channel Logout
* Allows IdP to notify Auth0 of logout as long as they send id or logout token containing sid & sub (session id & subject) claim so Auth0 knows which sessions/cookies to invalidate
* Apps must register a back channel callback URL for this to work so Auth0 knows what to call when logout occurs
* If one app logs out with Auth0 then Auth0 will log out of all other registered apps via callbacks
* Flow
  1. Login - During user authentication with apps, the Auth0 tenant adds the sid to the ID token
  2. Login - App stores the received session identifier in its own session store and associates it with the application-specific session
  3. Logout - App calls the pre-registered logout callback URL and posts the Logout Token to this endpoint. The token contains the user_id (sub) and the sid along with other parameters
  4. Logout - The applicationâ€™s backend needs to validate the Logout Token as per OIDC spec and extract the sid. Then the backend can use this token to find the session associated with the identifier and terminate it as necessary
* Limitations
  * Apps must be able to store sid
  * Apps can verify JWT tokens
  * Apps only accept tokens by trusted tenants
  * Apps must only accept tokens with sid
  * Apps must expose callback endpoints only via TLS
  * Apps recommended to only accept requests from published list of outbound IP addresses
  * Apps provide rate limiting
  * Any changes to endpoint address must be synce with Auth0 tenant

## Configure cross-origin authentication

## Set up authentication profile

## Understand and Implement Authentication APIs

## Implement JWT token validation using JWKS