let e,t,n,r,o,i,a,s,c;var l=globalThis,u={allowAccess:async()=>!0,render:async()=>`
      <h1>Not Found</h1>
    `,postRender:async()=>{}},d=async()=>{try{let e=await fetch(`${window.env.API_URL}/total`,{method:"GET",headers:{"Content-Type":"application/json"}});return await e.json()}catch(e){console.log("Error getting total",e)}},h=async()=>{try{return[{date:new Date,description:"Pizza for a Coding Dojo session.",value:102},{date:new Date,description:"Coffee for a Coding Dojo session.",value:42}]}catch(e){console.log("Error getting reports",e)}},p=async e=>{let t;return`
  <table border="1">
    ${t=Object.keys(e[0]),`
<tr>
  ${t.map(e=>`<th><strong>${e}</strong></th>`).join("\n ")}
</tr>
`}
    ${e.map(e=>`<tr>
   ${Object.keys(e).map(t=>{var n;return n=e[t],`<td>${"number"==typeof n?`$${n.toFixed(2)}`:n instanceof Date?n.toLocaleDateString("en-US"):n}</td>`}).join("\n ")}
  </tr>`).join("\n ")}
  </table>
  `};window.user={name:"Anonymous",picture:{}};var m=async()=>`
    <li class="logo">
      <a href="#">
        <img src="${{}}" alt="Auth0" />
      </a>
    </li>
    <li>
      <a id="home-link" href="#">Home</a>
    </li>
    <li>
      <a id="expenses-link" href="#expenses">Expenses</a>
    </li>
    <li class="spacer" />
    <li id="log-out" style="display: none">
      <a href="#"> Logout</a>
    </li>
    <li id="log-in" style="display: block">
      <a href="#"> Login</a>
    </li>
    <li class="profile">
      <img src="${window.user.picture}" />
    </li>
    `,f=async()=>{document.getElementById("log-in").addEventListener("click",async e=>{e.preventDefault()}),document.getElementById("log-out").addEventListener("click",e=>{e.preventDefault()})};let y={"/":{allowAccess:async()=>!0,render:async()=>{let e=await d();return`
    <h1>Home Page</h1>
    <p id="user-greet">Hello, ${window.user.name}</p>
    <p>So far, this app has been used to manage:</p>
    <div id="summary">
    <ul>
      <li><strong id="expenses-count">${e.count}</strong> expenses</li>
      <li>$<strong id="expenses-total">
      ${e.total.toFixed(2)}
      </strong> dollars</li>
    </ul>
    </div>    
    `},postRender:async()=>{}},expenses:{allowAccess:async()=>!1,render:async()=>{let e=await h();return`
    <h1>Expense Report</h1>
    <p id="user-greet">Hello, ${window.user.name}</p>
    <p>These are your expenses:</p>
    ${await p(e)}
    `},postRender:async()=>{}}},w=document.getElementById("navbar"),g=document.getElementById("content"),b=async()=>{new URLSearchParams(window.location.search).has("code")&&(await window.auth0Client.handleRedirectCallback(),window.history.replaceState({},document.title,"/"));let e=y[location.hash.slice(1).toLowerCase()||"/"]||u;await e.allowAccess()?(g.innerHTML=await e.render(),await e.postRender()):window.history.replaceState({},document.title,"/"),w.innerHTML=await m(),await f()};function v(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)0>t.indexOf(r[o])&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}"function"==typeof SuppressedError&&SuppressedError;var _="u">typeof globalThis?globalThis:"u">typeof window?window:void 0!==l?l:"u">typeof self?self:{},k={},S={};Object.defineProperty(S,"__esModule",{value:!0});var E=function(){function e(){var e=this;this.locked=new Map,this.addToLocked=function(t,n){var r=e.locked.get(t);void 0===r?void 0===n?e.locked.set(t,[]):e.locked.set(t,[n]):void 0!==n&&(r.unshift(n),e.locked.set(t,r))},this.isLocked=function(t){return e.locked.has(t)},this.lock=function(t){return new Promise(function(n,r){e.isLocked(t)?e.addToLocked(t,n):(e.addToLocked(t),n())})},this.unlock=function(t){var n=e.locked.get(t);if(void 0!==n&&0!==n.length){var r=n.pop();e.locked.set(t,n),void 0!==r&&setTimeout(r,0)}else e.locked.delete(t)}}return e.getInstance=function(){return void 0===e.instance&&(e.instance=new e),e.instance},e}();S.default=function(){return E.getInstance()};var A=_&&_.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},T=_&&_.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){var c=[i,s];if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}};Object.defineProperty(k,"__esModule",{value:!0});var P={key:function(e){return A(_,void 0,void 0,function(){return T(this,function(e){throw Error("Unsupported")})})},getItem:function(e){return A(_,void 0,void 0,function(){return T(this,function(e){throw Error("Unsupported")})})},clear:function(){return A(_,void 0,void 0,function(){return T(this,function(e){return[2,window.localStorage.clear()]})})},removeItem:function(e){return A(_,void 0,void 0,function(){return T(this,function(e){throw Error("Unsupported")})})},setItem:function(e,t){return A(_,void 0,void 0,function(){return T(this,function(e){throw Error("Unsupported")})})},keySync:function(e){return window.localStorage.key(e)},getItemSync:function(e){return window.localStorage.getItem(e)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(e){return window.localStorage.removeItem(e)},setItemSync:function(e,t){return window.localStorage.setItem(e,t)}};function R(e){return new Promise(function(t){return setTimeout(t,e)})}function I(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="",r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}var O=k.default=function(){function e(t){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+I(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=t,void 0===e.waiters&&(e.waiters=[])}return e.prototype.acquireLock=function(t,n){return void 0===n&&(n=5e3),A(this,void 0,void 0,function(){var r,o,i,a,s,c,l;return T(this,function(u){switch(u.label){case 0:r=Date.now()+I(4),o=Date.now()+n,i="browser-tabs-lock-key-"+t,a=void 0===this.storageHandler?P:this.storageHandler,u.label=1;case 1:return Date.now()<o?[4,R(30)]:[3,8];case 2:return u.sent(),null!==a.getItemSync(i)?[3,5]:(s=this.id+"-"+t+"-"+r,[4,R(Math.floor(25*Math.random()))]);case 3:return u.sent(),a.setItemSync(i,JSON.stringify({id:this.id,iat:r,timeoutKey:s,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,R(30)];case 4:return u.sent(),null!==(c=a.getItemSync(i))&&(l=JSON.parse(c)).id===this.id&&l.iat===r?(this.acquiredIatSet.add(r),this.refreshLockWhileAcquired(i,r),[2,!0]):[3,7];case 5:return e.lockCorrector(void 0===this.storageHandler?P:this.storageHandler),[4,this.waitForSomethingToChange(o)];case 6:u.sent(),u.label=7;case 7:return r=Date.now()+I(4),[3,1];case 8:return[2,!1]}})})},e.prototype.refreshLockWhileAcquired=function(e,t){return A(this,void 0,void 0,function(){var n=this;return T(this,function(r){return setTimeout(function(){return A(n,void 0,void 0,function(){var n,r,o;return T(this,function(i){switch(i.label){case 0:return[4,S.default().lock(t)];case 1:return i.sent(),this.acquiredIatSet.has(t)?null===(r=(n=void 0===this.storageHandler?P:this.storageHandler).getItemSync(e))?S.default().unlock(t):((o=JSON.parse(r)).timeRefreshed=Date.now(),n.setItemSync(e,JSON.stringify(o)),S.default().unlock(t),this.refreshLockWhileAcquired(e,t)):S.default().unlock(t),[2]}})})},1e3),[2]})})},e.prototype.waitForSomethingToChange=function(t){return A(this,void 0,void 0,function(){return T(this,function(n){switch(n.label){case 0:return[4,new Promise(function(n){var r=!1,o=Date.now(),i=!1;function a(){if(i||(window.removeEventListener("storage",a),e.removeFromWaiting(a),clearTimeout(s),i=!0),!r){r=!0;var t=50-(Date.now()-o);t>0?setTimeout(n,t):n(null)}}window.addEventListener("storage",a),e.addToWaiting(a);var s=setTimeout(a,Math.max(0,t-Date.now()))})];case 1:return n.sent(),[2]}})})},e.addToWaiting=function(t){this.removeFromWaiting(t),void 0!==e.waiters&&e.waiters.push(t)},e.removeFromWaiting=function(t){void 0!==e.waiters&&(e.waiters=e.waiters.filter(function(e){return e!==t}))},e.notifyWaiters=function(){void 0!==e.waiters&&e.waiters.slice().forEach(function(e){return e()})},e.prototype.releaseLock=function(e){return A(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this.releaseLock__private__(e)];case 1:return[2,t.sent()]}})})},e.prototype.releaseLock__private__=function(t){return A(this,void 0,void 0,function(){var n,r,o,i;return T(this,function(a){switch(a.label){case 0:return n=void 0===this.storageHandler?P:this.storageHandler,r="browser-tabs-lock-key-"+t,null===(o=n.getItemSync(r))?[2]:(i=JSON.parse(o)).id!==this.id?[3,2]:[4,S.default().lock(i.iat)];case 1:a.sent(),this.acquiredIatSet.delete(i.iat),n.removeItemSync(r),S.default().unlock(i.iat),e.notifyWaiters(),a.label=2;case 2:return[2]}})})},e.lockCorrector=function(t){for(var n=Date.now()-5e3,r=[],o=0;;){var i=t.keySync(o);if(null===i)break;r.push(i),o++}for(var a=!1,s=0;s<r.length;s++){var c=r[s];if(c.includes("browser-tabs-lock-key")){var l=t.getItemSync(c);if(null!==l){var u=JSON.parse(l);(void 0===u.timeRefreshed&&u.timeAcquired<n||void 0!==u.timeRefreshed&&u.timeRefreshed<n)&&(t.removeItemSync(c),a=!0)}}}a&&e.notifyWaiters()},e.waiters=void 0,e}();let x={timeoutInSeconds:60},C={name:"auth0-spa-js",version:"2.12.0"},j=()=>Date.now();class D extends Error{constructor(e,t){super(t),this.error=e,this.error_description=t,Object.setPrototypeOf(this,D.prototype)}static fromPayload(e){let{error:t,error_description:n}=e;return new D(t,n)}}class L extends D{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e,t),this.state=n,this.appState=r,Object.setPrototypeOf(this,L.prototype)}}class K extends D{constructor(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(e,t),this.connection=n,this.state=r,this.appState=o,Object.setPrototypeOf(this,K.prototype)}}class U extends D{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,U.prototype)}}class N extends U{constructor(e){super(),this.popup=e,Object.setPrototypeOf(this,N.prototype)}}class W extends D{constructor(e){super("cancelled","Popup closed"),this.popup=e,Object.setPrototypeOf(this,W.prototype)}}class H extends D{constructor(){super("popup_open","Unable to open a popup for loginWithPopup - window.open returned `null`"),Object.setPrototypeOf(this,H.prototype)}}class z extends D{constructor(e,t,n){super(e,t),this.mfa_token=n,Object.setPrototypeOf(this,z.prototype)}}class J extends D{constructor(e,t){super("missing_refresh_token","Missing Refresh Token (audience: '".concat(G(e,["default"]),"', scope: '").concat(G(t),"')")),this.audience=e,this.scope=t,Object.setPrototypeOf(this,J.prototype)}}class M extends D{constructor(e,t){super("missing_scopes","Missing requested scopes after refresh (audience: '".concat(G(e,["default"]),"', missing scope: '").concat(G(t),"')")),this.audience=e,this.scope=t,Object.setPrototypeOf(this,M.prototype)}}class V extends D{constructor(e){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=e,Object.setPrototypeOf(this,V.prototype)}}function G(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e&&!t.includes(e)?e:""}let F=()=>{let e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",t="";return Array.from(window.crypto.getRandomValues(new Uint8Array(43))).forEach(n=>t+=e[n%e.length]),t},Z=[{key:"name",type:["string"]},{key:"version",type:["string","number"]},{key:"env",type:["object"]}],q=e=>{let t;var{clientId:n}=e;return new URLSearchParams(Object.keys(t=Object.assign({client_id:n},v(e,["clientId"]))).filter(e=>void 0!==t[e]).reduce((e,n)=>Object.assign(Object.assign({},e),{[n]:t[n]}),{})).toString()},B=async e=>{let t=window.crypto.subtle.digest({name:"SHA-256"},(new TextEncoder).encode(e));return await t},X=e=>decodeURIComponent(atob(e.replace(/_/g,"/").replace(/-/g,"+")).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("")),Y=e=>{var t;let n,r=new Uint8Array(e);return t=window.btoa(String.fromCharCode(...Array.from(r))),n={"+":"-","/":"_","=":""},t.replace(/[+/=]/g,e=>n[e])},Q=new TextEncoder,$=new TextDecoder;function ee(e){return"string"==typeof e?Q.encode(e):$.decode(e)}function et(e){if("number"!=typeof e.modulusLength||e.modulusLength<2048)throw new eo(`${e.name} modulusLength must be at least 2048 bits`)}async function en(t,n,r){var o,i,a;if(!1===r.usages.includes("sign"))throw TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');let s=`${(o=ee(JSON.stringify(t)),e(o))}.${(i=ee(JSON.stringify(n)),e(i))}`;return`${s}.${a=await crypto.subtle.sign(function(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return et(e.algorithm),{name:e.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return et(e.algorithm),{name:e.algorithm.name};case"Ed25519":return{name:e.algorithm.name}}throw new er}(r),r,ee(s)),e(a)}`}e=Uint8Array.prototype.toBase64?e=>(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e.toBase64({alphabet:"base64url",omitPadding:!0})):e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let n=0;n<e.byteLength;n+=32768)t.push(String.fromCharCode.apply(null,e.subarray(n,n+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};class er extends Error{constructor(e){var t;super(null!=e?e:"operation not supported"),this.name=this.constructor.name,null==(t=Error.captureStackTrace)||t.call(Error,this,this.constructor)}}class eo extends Error{constructor(e){var t;super(e),this.name=this.constructor.name,null==(t=Error.captureStackTrace)||t.call(Error,this,this.constructor)}}function ei(e){return e instanceof CryptoKey}function ea(e){return ei(e)&&"public"===e.type}async function es(t,n,r,o,i,a){var s;let c=null==t?void 0:t.privateKey,l=null==t?void 0:t.publicKey;if(!ei(c)||"private"!==c.type)throw TypeError('"keypair.privateKey" must be a private CryptoKey');if(!ea(l))throw TypeError('"keypair.publicKey" must be a public CryptoKey');if(!0!==l.extractable)throw TypeError('"keypair.publicKey.extractable" must be true');if("string"!=typeof n)throw TypeError('"htu" must be a string');if("string"!=typeof r)throw TypeError('"htm" must be a string');if(void 0!==o&&"string"!=typeof o)throw TypeError('"nonce" must be a string or undefined');if(void 0!==i&&"string"!=typeof i)throw TypeError('"accessToken" must be a string or undefined');if(void 0!==a&&("object"!=typeof a||null===a||Array.isArray(a)))throw TypeError('"additional" must be an object');return en({alg:function(e){switch(e.algorithm.name){case"RSA-PSS":if("SHA-256"===e.algorithm.hash.name)return"PS256";throw new er("unsupported RsaHashedKeyAlgorithm hash name");case"RSASSA-PKCS1-v1_5":if("SHA-256"===e.algorithm.hash.name)return"RS256";throw new er("unsupported RsaHashedKeyAlgorithm hash name");case"ECDSA":if("P-256"===e.algorithm.namedCurve)return"ES256";throw new er("unsupported EcKeyAlgorithm namedCurve");case"Ed25519":return"Ed25519";default:throw new er("unsupported CryptoKey algorithm name")}}(c),typ:"dpop+jwt",jwk:await ec(l)},Object.assign(Object.assign({},a),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:r,nonce:o,htu:n,ath:i?(s=await crypto.subtle.digest("SHA-256",ee(i)),e(s)):void 0}),c)}async function ec(e){let{kty:t,e:n,n:r,x:o,y:i,crv:a}=await crypto.subtle.exportKey("jwk",e);return{kty:t,crv:a,e:n,n:r,x:o,y:i}}let el=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange"],eu=async(e,t)=>{let n=await fetch(e,t);return{ok:n.ok,json:await n.json(),headers:[...n.headers].reduce((e,t)=>{let[n,r]=t;return e[n]=r,e},{})}},ed=async(e,t,n)=>{let r,o=new AbortController;return t.signal=o.signal,Promise.race([eu(e,t),new Promise((e,t)=>{r=setTimeout(()=>{o.abort(),t(Error("Timeout when executing 'fetch'"))},n)})]).finally(()=>{clearTimeout(r)})},eh=async(e,t,n,r,o,i,a,s)=>{let c;return c={auth:{audience:t,scope:n},timeout:o,fetchUrl:e,fetchOptions:r,useFormData:a,useMrrt:s},new Promise(function(e,t){let n=new MessageChannel;n.port1.onmessage=function(r){r.data.error?t(Error(r.data.error)):e(r.data),n.port1.close()},i.postMessage(c,[n.port2])})},ep=async function(e,t,n,r,o,i){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e4,s=arguments.length>7?arguments[7]:void 0;return o?eh(e,t,n,r,a,o,i,s):ed(e,r,a)};async function em(e,t,n,r,o,i,a,s,c,l){let u;if(c){let t=await c.generateProof({url:e,method:o.method||"GET",nonce:await c.getNonce()});o.headers=Object.assign(Object.assign({},o.headers),{dpop:t})}let d,h=null;for(let c=0;c<3;c++)try{d=await ep(e,n,r,o,i,a,t,s),h=null;break}catch(e){h=e}if(h)throw h;let p=d.json,{error:m,error_description:f}=p,y=v(p,["error","error_description"]),{headers:w,ok:g}=d;if(c&&(u=w["dpop-nonce"])&&await c.setNonce(u),!g){let d=f||"HTTP error. Unable to fetch ".concat(e);if("mfa_required"===m)throw new z(m,d,y.mfa_token);if("missing_refresh_token"===m)throw new J(n,r);if("use_dpop_nonce"===m){if(!c||!u||l)throw new V(u);return em(e,t,n,r,o,i,a,s,c,!0)}throw new D(m||"request_error",d)}return y}async function ef(e,t){let n;var r,{baseUrl:o,timeout:i,audience:a,scope:s,auth0Client:c,useFormData:l,useMrrt:u,dpop:d}=e,h=v(e,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);let p="urn:ietf:params:oauth:grant-type:token-exchange"===h.grant_type,m="refresh_token"===h.grant_type&&u,f=Object.assign(Object.assign(Object.assign(Object.assign({},h),p&&a&&{audience:a}),p&&s&&{scope:s}),m&&{audience:a,scope:s}),y=l?q(f):JSON.stringify(f),w=(r=h.grant_type,el.includes(r));return await em("".concat(o,"/oauth/token"),i,a||"default",s,{method:"POST",body:y,headers:{"Content-Type":l?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(Object.keys(n=c||C).reduce((e,t)=>{let r=Z.find(e=>e.key===t);return r&&r.type.includes(typeof n[t])&&(e[t]=n[t]),e},{})))}},t,l,u,w?d:void 0)}let ey=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Array.from(new Set(t.filter(Boolean).join(" ").trim().split(/\s+/))).join(" ")},ew=(e,t,n)=>{let r;return n&&(r=e[n]),r||(r=e.default),ey(r,t)};class eg{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"@@auth0spajs@@",n=arguments.length>2?arguments[2]:void 0;this.prefix=t,this.suffix=n,this.clientId=e.clientId,this.scope=e.scope,this.audience=e.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(e){let[t,n,r,o]=e.split("::");return new eg({clientId:n,scope:o,audience:r},t)}static fromCacheEntry(e){let{scope:t,audience:n,client_id:r}=e;return new eg({scope:t,audience:n,clientId:r})}}class eb{set(e,t){localStorage.setItem(e,JSON.stringify(t))}get(e){let t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return}}remove(e){localStorage.removeItem(e)}allKeys(){return Object.keys(window.localStorage).filter(e=>e.startsWith("@@auth0spajs@@"))}}class ev{constructor(){let e;this.enclosedCache=(e={},{set(t,n){e[t]=n},get(t){let n=e[t];if(n)return n},remove(t){delete e[t]},allKeys:()=>Object.keys(e)})}}class e_{constructor(e,t,n){this.cache=e,this.keyManifest=t,this.nowProvider=n||j}async setIdToken(e,t,n){var r;let o=this.getIdTokenCacheKey(e);await this.cache.set(o,{id_token:t,decodedToken:n}),await (null==(r=this.keyManifest)?void 0:r.add(o))}async getIdToken(e){let t=await this.cache.get(this.getIdTokenCacheKey(e.clientId));if(!t&&e.scope&&e.audience){let t=await this.get(e);if(!t||!t.id_token||!t.decodedToken)return;return{id_token:t.id_token,decodedToken:t.decodedToken}}if(t)return{id_token:t.id_token,decodedToken:t.decodedToken}}async get(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0,i=await this.cache.get(e.toKey());if(!i){let t=await this.getCacheKeys();if(!t)return;let n=this.matchExistingCacheKey(e,t);if(n&&(i=await this.cache.get(n)),!i&&r&&"cache-only"!==o)return this.getEntryWithRefreshToken(e,t)}if(!i)return;let a=Math.floor(await this.nowProvider()/1e3);return i.expiresAt-n<a?i.body.refresh_token?this.modifiedCachedEntry(i,e):(await this.cache.remove(e.toKey()),void await (null==(t=this.keyManifest)?void 0:t.remove(e.toKey()))):i.body}async modifiedCachedEntry(e,t){return e.body={refresh_token:e.body.refresh_token,audience:e.body.audience,scope:e.body.scope},await this.cache.set(t.toKey(),e),{refresh_token:e.body.refresh_token,audience:e.body.audience,scope:e.body.scope}}async set(e){var t;let n=new eg({clientId:e.client_id,scope:e.scope,audience:e.audience}),r=await this.wrapCacheEntry(e);await this.cache.set(n.toKey(),r),await (null==(t=this.keyManifest)?void 0:t.add(n.toKey()))}async remove(e,t,n){let r=new eg({clientId:e,scope:n,audience:t});await this.cache.remove(r.toKey())}async clear(e){var t;let n=await this.getCacheKeys();n&&(await n.filter(t=>!e||t.includes(e)).reduce(async(e,t)=>{await e,await this.cache.remove(t)},Promise.resolve()),await (null==(t=this.keyManifest)?void 0:t.clear()))}async wrapCacheEntry(e){return{body:e,expiresAt:Math.floor(await this.nowProvider()/1e3)+e.expires_in}}async getCacheKeys(){var e;return this.keyManifest?null==(e=await this.keyManifest.get())?void 0:e.keys:this.cache.allKeys?this.cache.allKeys():void 0}getIdTokenCacheKey(e){return new eg({clientId:e},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(e,t){return t.filter(t=>{var n;let r=eg.fromKey(t),o=new Set(r.scope&&r.scope.split(" ")),i=(null==(n=e.scope)?void 0:n.split(" "))||[],a=r.scope&&i.reduce((e,t)=>e&&o.has(t),!0);return"@@auth0spajs@@"===r.prefix&&r.clientId===e.clientId&&r.audience===e.audience&&a})[0]}async getEntryWithRefreshToken(e,t){var n;for(let r of t){let t=eg.fromKey(r);if("@@auth0spajs@@"===t.prefix&&t.clientId===e.clientId){let t=await this.cache.get(r);if(null==(n=null==t?void 0:t.body)?void 0:n.refresh_token)return this.modifiedCachedEntry(t,e)}}}async updateEntry(e,t){var n;let r=await this.getCacheKeys();if(r)for(let o of r){let r=await this.cache.get(o);if((null==(n=null==r?void 0:r.body)?void 0:n.refresh_token)===e){let e=Object.assign(Object.assign({},r.body),{refresh_token:t});await this.set(e)}}}}class ek{constructor(e,t,n){this.storage=e,this.clientId=t,this.cookieDomain=n,this.storageKey="".concat("a0.spajs.txs",".").concat(this.clientId)}create(e){this.storage.save(this.storageKey,e,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}let eS=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"];var eE=_&&_.__assign||function(){return(eE=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function eA(e,t){if(!t)return"";var n="; "+e;return!0===t?n:n+"="+t}function eT(e,t,n){var r;document.cookie=(r=eE({path:"/"},n),encodeURIComponent(e).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(t).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(e){if("number"==typeof e.expires){var t=new Date;t.setMilliseconds(t.getMilliseconds()+864e5*e.expires),e.expires=t}return eA("Expires",e.expires?e.expires.toUTCString():"")+eA("Domain",e.domain)+eA("Path",e.path)+eA("Secure",e.secure)+eA("SameSite",e.sameSite)}(r))}var eP=function(e,t){eT(e,"",eE(eE({},t),{expires:-1}))};let eR={get(e){let t=function(e){for(var t={},n=e?e.split("; "):[],r=/(%[\dA-F]{2})+/gi,o=0;o<n.length;o++){var i=n[o].split("="),a=i.slice(1).join("=");'"'===a.charAt(0)&&(a=a.slice(1,-1));try{t[i[0].replace(r,decodeURIComponent)]=a.replace(r,decodeURIComponent)}catch(e){}}return t}(document.cookie)[e];if(void 0!==t)return JSON.parse(t)},save(e,t,n){let r={};"https:"===window.location.protocol&&(r={secure:!0,sameSite:"none"}),(null==n?void 0:n.daysUntilExpire)&&(r.expires=n.daysUntilExpire),(null==n?void 0:n.cookieDomain)&&(r.domain=n.cookieDomain),eT(e,JSON.stringify(t),r)},remove(e,t){let n={};(null==t?void 0:t.cookieDomain)&&(n.domain=t.cookieDomain),eP(e,n)}},eI={get:e=>eR.get(e)||eR.get("".concat("_legacy_").concat(e)),save(e,t,n){let r={};"https:"===window.location.protocol&&(r={secure:!0}),(null==n?void 0:n.daysUntilExpire)&&(r.expires=n.daysUntilExpire),(null==n?void 0:n.cookieDomain)&&(r.domain=n.cookieDomain),eT("".concat("_legacy_").concat(e),JSON.stringify(t),r),eR.save(e,t,n)},remove(e,t){let n={};(null==t?void 0:t.cookieDomain)&&(n.domain=t.cookieDomain),eP(e,n),eR.remove(e,t),eR.remove("".concat("_legacy_").concat(e),t)}},eO={get(e){if("u"<typeof sessionStorage)return;let t=sessionStorage.getItem(e);return null!=t?JSON.parse(t):void 0},save(e,t){sessionStorage.setItem(e,JSON.stringify(t))},remove(e){sessionStorage.removeItem(e)}};(ex=eC||(eC={})).Code="code",ex.ConnectCode="connect_code";var ex,eC,ej,eD=function(e){var t,n,r;return new Worker(ej=ej||(n=(t=function(e,t){var n=atob(e);if(t){for(var r=new Uint8Array(n.length),o=0,i=n.length;o<i;++o)r[o]=n.charCodeAt(o);return String.fromCharCode.apply(null,new Uint16Array(r.buffer))}return n}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHQpe2xldHtlcnJvcjpyLGVycm9yX2Rlc2NyaXB0aW9uOnN9PXQ7cmV0dXJuIG5ldyBlKHIscyl9fWNsYXNzIHQgZXh0ZW5kcyBle2NvbnN0cnVjdG9yKGUscyl7c3VwZXIoIm1pc3NpbmdfcmVmcmVzaF90b2tlbiIsIk1pc3NpbmcgUmVmcmVzaCBUb2tlbiAoYXVkaWVuY2U6ICciLmNvbmNhdChyKGUsWyJkZWZhdWx0Il0pLCInLCBzY29wZTogJyIpLmNvbmNhdChyKHMpLCInKSIpKSx0aGlzLmF1ZGllbmNlPWUsdGhpcy5zY29wZT1zLE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLHQucHJvdG90eXBlKX19ZnVuY3Rpb24gcihlKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06W107cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+IiIuY29uY2F0KGUsInwiKS5jb25jYXQodCk7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jIGU9PntsZXQgcixjLHtkYXRhOnt0aW1lb3V0OmksYXV0aDphLGZldGNoVXJsOmYsZmV0Y2hPcHRpb25zOmwsdXNlRm9ybURhdGE6cCx1c2VNcnJ0Omh9LHBvcnRzOlt1XX09ZSxkPXt9O2NvbnN0e2F1ZGllbmNlOmcsc2NvcGU6eX09YXx8e307dHJ5e2NvbnN0IGU9cD8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShsLmJvZHkpOkpTT04ucGFyc2UobC5ib2R5KTtpZighZS5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1lLmdyYW50X3R5cGUpe2lmKGM9KChlLHQpPT5vW24oZSx0KV0pKGcseSksIWMmJmgpe2NvbnN0IGU9by5sYXRlc3RfcmVmcmVzaF90b2tlbix0PSgoZSx0KT0+e2NvbnN0IHI9T2JqZWN0LmtleXMobykuZmluZCgocj0+e2lmKCJsYXRlc3RfcmVmcmVzaF90b2tlbiIhPT1yKXtjb25zdCBzPSgoZSx0KT0+dC5zdGFydHNXaXRoKCIiLmNvbmNhdChlLCJ8IikpKSh0LHIpLG89ci5zcGxpdCgifCIpWzFdLnNwbGl0KCIgIiksbj1lLnNwbGl0KCIgIikuZXZlcnkoKGU9Pm8uaW5jbHVkZXMoZSkpKTtyZXR1cm4gcyYmbn19KSk7cmV0dXJuISFyfSkoeSxnKTtlJiYhdCYmKGM9ZSl9aWYoIWMpdGhyb3cgbmV3IHQoZyx5KTtsLmJvZHk9cD9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpfWxldCBhLGs7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGE9bmV3IEFib3J0Q29udHJvbGxlcixsLnNpZ25hbD1hLnNpZ25hbCk7dHJ5e2s9YXdhaXQgUHJvbWlzZS5yYWNlKFsoaj1pLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsaikpKSksZmV0Y2goZixPYmplY3QuYXNzaWduKHt9LGwpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHUucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFrKXJldHVybiBhJiZhLmFib3J0KCksdm9pZCB1LnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO189ay5oZWFkZXJzLGQ9Wy4uLl9dLnJlZHVjZSgoKGUsdCk9PntsZXRbcixzXT10O3JldHVybiBlW3JdPXMsZX0pLHt9KSxyPWF3YWl0IGsuanNvbigpLHIucmVmcmVzaF90b2tlbj8oaCYmKG8ubGF0ZXN0X3JlZnJlc2hfdG9rZW49ci5yZWZyZXNoX3Rva2VuLE89YyxiPXIucmVmcmVzaF90b2tlbixPYmplY3QuZW50cmllcyhvKS5mb3JFYWNoKChlPT57bGV0W3Qscl09ZTtyPT09TyYmKG9bdF09Yil9KSkpLCgoZSx0LHIpPT57b1tuKHQscildPWV9KShyLnJlZnJlc2hfdG9rZW4sZyx5KSxkZWxldGUgci5yZWZyZXNoX3Rva2VuKTooKGUsdCk9PntkZWxldGUgb1tuKGUsdCldfSkoZyx5KSx1LnBvc3RNZXNzYWdlKHtvazprLm9rLGpzb246cixoZWFkZXJzOmR9KX1jYXRjaChlKXt1LnBvc3RNZXNzYWdlKHtvazohMSxqc29uOntlcnJvcjplLmVycm9yLGVycm9yX2Rlc2NyaXB0aW9uOmUubWVzc2FnZX0saGVhZGVyczpkfSl9dmFyIE8sYixfLGp9KSl9KCk7Cgo=",!1)).indexOf("\n",10)+1,r=new Blob([t.substring(n)+""],{type:"application/javascript"}),URL.createObjectURL(r)),e)};let eL={},eK=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(let n=0;n<t;n++)if(await e())return!0;return!1};class eU{constructor(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}async add(e){var t;let n=new Set((null==(t=await this.cache.get(this.manifestKey))?void 0:t.keys)||[]);n.add(e),await this.cache.set(this.manifestKey,{keys:[...n]})}async remove(e){let t=await this.cache.get(this.manifestKey);if(t){let n=new Set(t.keys);return n.delete(e),n.size>0?await this.cache.set(this.manifestKey,{keys:[...n]}):await this.cache.remove(this.manifestKey)}}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(e){return"".concat("@@auth0spajs@@","::").concat(e)}}let eN={memory:()=>(new ev).enclosedCache,localstorage:()=>new eb},eW=e=>eN[e],eH=e=>{let{openUrl:t,onRedirect:n}=e;return Object.assign(Object.assign({},v(e,["openUrl","onRedirect"])),{openUrl:!1===t||t?t:n})},ez=(e,t)=>{let n=(null==t?void 0:t.split(" "))||[];return((null==e?void 0:e.split(" "))||[]).every(e=>n.includes(e))},eJ={NONCE:"nonce",KEYPAIR:"keypair"};class eM{constructor(e){this.clientId=e}getVersion(){return 1}createDbHandle(){let e=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((t,n)=>{e.onupgradeneeded=()=>Object.values(eJ).forEach(t=>e.result.createObjectStore(t)),e.onerror=()=>n(e.error),e.onsuccess=()=>t(e.result)})}async getDbHandle(){return this.dbHandle||(this.dbHandle=await this.createDbHandle()),this.dbHandle}async executeDbRequest(e,t,n){let r=n((await this.getDbHandle()).transaction(e,t).objectStore(e));return new Promise((e,t)=>{r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}buildKey(e){return"".concat(this.clientId,"::").concat(e?"_".concat(e):"auth0")}setNonce(e,t){return this.save(eJ.NONCE,this.buildKey(t),e)}setKeyPair(e){return this.save(eJ.KEYPAIR,this.buildKey(),e)}async save(e,t,n){await this.executeDbRequest(e,"readwrite",e=>e.put(n,t))}findNonce(e){return this.find(eJ.NONCE,this.buildKey(e))}findKeyPair(){return this.find(eJ.KEYPAIR,this.buildKey())}find(e,t){return this.executeDbRequest(e,"readonly",e=>e.get(t))}async deleteBy(e,t){let n=await this.executeDbRequest(e,"readonly",e=>e.getAllKeys());null==n||n.filter(t).map(t=>this.executeDbRequest(e,"readwrite",e=>e.delete(t)))}deleteByClientId(e,t){return this.deleteBy(e,e=>"string"==typeof e&&e.startsWith("".concat(t,"::")))}clearNonces(){return this.deleteByClientId(eJ.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(eJ.KEYPAIR,this.clientId)}}class eV{constructor(e){this.storage=new eM(e)}getNonce(e){return this.storage.findNonce(e)}setNonce(e,t){return this.storage.setNonce(e,t)}async getOrGenerateKeyPair(){let e=await this.storage.findKeyPair();return e||(e=await async function(e,t){var n;let r;if("string"!=typeof e||0===e.length)throw TypeError('"alg" must be a non-empty string');switch(e){case"PS256":r={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":r={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":r={name:"Ed25519"};break;default:throw new er}return crypto.subtle.generateKey(r,null!=(n=null==t?void 0:t.extractable)&&n,["sign","verify"])}("ES256",{extractable:!1}),await this.storage.setKeyPair(e)),e}async generateProof(e){return function(e){let t,{keyPair:n,url:r,method:o,nonce:i,accessToken:a}=e;return es(n,((t=new URL(r)).search="",t.hash="",t.href),o,i,a)}(Object.assign({keyPair:await this.getOrGenerateKeyPair()},e))}async calculateThumbprint(){return async function(t){var n;let r;if(!ea(t))throw TypeError('"publicKey" must be a public CryptoKey');if(!0!==t.extractable)throw TypeError('"publicKey.extractable" must be true');let o=await ec(t);switch(o.kty){case"EC":r={crv:o.crv,kty:o.kty,x:o.x,y:o.y};break;case"OKP":r={crv:o.crv,kty:o.kty,x:o.x};break;case"RSA":r={e:o.e,kty:o.kty,n:o.n};break;default:throw new er("unsupported JWK kty")}return n=await crypto.subtle.digest({name:"SHA-256"},ee(JSON.stringify(r))),e(n)}((await this.getOrGenerateKeyPair()).publicKey)}async clear(){await Promise.all([this.storage.clearNonces(),this.storage.clearKeyPairs()])}}(r_=rk||(rk={})).Bearer="Bearer",r_.DPoP="DPoP";class eG{constructor(e,t){this.hooks=t,this.config=Object.assign(Object.assign({},e),{fetch:e.fetch||("u"<typeof window?fetch:window.fetch.bind(window))})}isAbsoluteUrl(e){return/^(https?:)?\/\//i.test(e)}buildUrl(e,t){if(t){if(this.isAbsoluteUrl(t))return t;if(e)return"".concat(e.replace(/\/?\/$/,""),"/").concat(t.replace(/^\/+/,""))}throw TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(e){return this.config.getAccessToken?this.config.getAccessToken(e):this.hooks.getAccessToken(e)}extractUrl(e){return"string"==typeof e?e:e instanceof URL?e.href:e.url}buildBaseRequest(e,t){if(!this.config.baseUrl)return new Request(e,t);let n=this.buildUrl(this.config.baseUrl,this.extractUrl(e)),r=e instanceof Request?new Request(n,e):n;return new Request(r,t)}setAuthorizationHeader(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rk.Bearer;e.headers.set("authorization","".concat(n," ").concat(t))}async setDpopProofHeader(e,t){if(!this.config.dpopNonceId)return;let n=await this.hooks.getDpopNonce(),r=await this.hooks.generateDpopProof({accessToken:t,method:e.method,nonce:n,url:e.url});e.headers.set("dpop",r)}async prepareRequest(e,t){let n,r,o=await this.getAccessToken(t);"string"==typeof o?(n=this.config.dpopNonceId?rk.DPoP:rk.Bearer,r=o):(n=o.token_type,r=o.access_token),this.setAuthorizationHeader(e,r,n),n===rk.DPoP&&await this.setDpopProofHeader(e,r)}getHeader(e,t){return Array.isArray(e)?new Headers(e).get(t)||"":"function"==typeof e.get?e.get(t)||"":e[t]||""}hasUseDpopNonceError(e){if(401!==e.status)return!1;let t=this.getHeader(e.headers,"www-authenticate");return t.includes("invalid_dpop_nonce")||t.includes("use_dpop_nonce")}async handleResponse(e,t){let n=this.getHeader(e.headers,"dpop-nonce");if(n&&await this.hooks.setDpopNonce(n),!this.hasUseDpopNonceError(e))return e;if(!n||!t.onUseDpopNonceError)throw new V(n);return t.onUseDpopNonceError()}async internalFetchWithAuth(e,t,n,r){let o=this.buildBaseRequest(e,t);await this.prepareRequest(o,r);let i=await this.config.fetch(o);return this.handleResponse(i,n)}fetchWithAuth(e,t,n){let r={onUseDpopNonceError:()=>this.internalFetchWithAuth(e,t,Object.assign(Object.assign({},r),{onUseDpopNonceError:void 0}),n)};return this.internalFetchWithAuth(e,t,r,n)}}class eF{constructor(e,t){this.myAccountFetcher=e,this.apiBase=t}async connectAccount(e){let t=await this.myAccountFetcher.fetchWithAuth("".concat(this.apiBase,"v1/connected-accounts/connect"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return this._handleResponse(t)}async completeAccount(e){let t=await this.myAccountFetcher.fetchWithAuth("".concat(this.apiBase,"v1/connected-accounts/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return this._handleResponse(t)}async _handleResponse(e){let t;try{t=await e.text(),t=JSON.parse(t)}catch(n){throw new eZ({type:"invalid_json",status:e.status,title:"Invalid JSON response",detail:t||String(n)})}if(e.ok)return t;throw new eZ(t)}}class eZ extends Error{constructor(e){let{type:t,status:n,title:r,detail:o,validation_errors:i}=e;super(o),this.name="MyAccountApiError",this.type=t,this.status=n,this.title=r,this.detail=o,this.validation_errors=i,Object.setPrototypeOf(this,eZ.prototype)}}function eq(e,t){this.v=e,this.k=t}function eB(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw TypeError("Private element is not present on this object")}function eX(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function eY(e,t){return e.get(eB(e,t))}function eQ(e,t,n){eX(e,t),t.set(e,n)}function e$(e,t,n){return e.set(eB(e,t),n),n}function e0(e,t,n){var r;return(t="symbol"==typeof(r=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?r:r+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function e1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e1(Object(n),!0).forEach(function(t){e0(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e1(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function e5(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],-1===t.indexOf(n)&&({}).propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function e3(e){var t,n;function r(t,n){try{var i=e[t](n),a=i.value,s=a instanceof eq;Promise.resolve(s?a.v:a).then(function(n){if(s){var c="return"===t?"return":"next";if(!a.k||n.done)return r(c,n);n=e[c](n).value}o(i.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){o("throw",e)}}function o(e,o){switch(e){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,o){return new Promise(function(i,a){var s={key:e,arg:o,resolve:i,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,o))})},"function"!=typeof e.return&&(this.return=void 0)}function e6(e,t){if(null==e)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch(e){return!1}}function e9(e,t,n){let r=TypeError(e,{cause:n});return Object.assign(r,{code:t}),r}e3.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},e3.prototype.next=function(e){return this._invoke("next",e)},e3.prototype.throw=function(e){return this._invoke("throw",e)},e3.prototype.return=function(e){return this._invoke("return",e)},("u"<typeof navigator||null==(rS=navigator.userAgent)||null==(rE=rS.startsWith)||!rE.call(rS,"Mozilla/5.0 "))&&(t="".concat("oauth4webapi","/").concat("v3.8.3"));let e4=Symbol(),e8=Symbol(),e7=Symbol(),te=Symbol(),tt=Symbol(),tn=Symbol(),tr=new TextEncoder,to=new TextDecoder;function ti(e){return"string"==typeof e?tr.encode(e):to.decode(e)}function ta(e){return"string"==typeof e?r(e):n(e)}n=Uint8Array.prototype.toBase64?e=>(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e.toBase64({alphabet:"base64url",omitPadding:!0})):e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let n=0;n<e.byteLength;n+=32768)t.push(String.fromCharCode.apply(null,e.subarray(n,n+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},r=Uint8Array.fromBase64?e=>{try{return Uint8Array.fromBase64(e,{alphabet:"base64url"})}catch(e){throw e9("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",e)}}:e=>{try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}catch(e){throw e9("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",e)}};class ts extends Error{constructor(e,t){var n;super(e,t),e0(this,"code",void 0),this.name=this.constructor.name,this.code=t2,null==(n=Error.captureStackTrace)||n.call(Error,this,this.constructor)}}class tc extends Error{constructor(e,t){var n;super(e,t),e0(this,"code",void 0),this.name=this.constructor.name,null!=t&&t.code&&(this.code=null==t?void 0:t.code),null==(n=Error.captureStackTrace)||n.call(Error,this,this.constructor)}}function tl(e,t,n){return new tc(e,{code:t,cause:n})}function tu(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function td(e){e6(e,Headers)&&(e=Object.fromEntries(e.entries()));let n=new Headers(null!=e?e:{});if(t&&!n.has("user-agent")&&n.set("user-agent",t),n.has("authorization"))throw e9('"options.headers" must not include the "authorization" header name',"ERR_INVALID_ARG_VALUE");return n}function th(e,t){if(void 0!==t){if("function"==typeof t&&(t=t(e.href)),!(t instanceof AbortSignal))throw e9('"options.signal" must return or be an instance of AbortSignal',"ERR_INVALID_ARG_TYPE");return t}}function tp(e){return e.includes("//")?e.replace("//","/"):e}async function tm(e,t){return async function(e,t,n,r){if(!(e instanceof URL))throw e9('"'.concat(t,'" must be an instance of URL'),"ERR_INVALID_ARG_TYPE");tT(e,!0!==(null==r?void 0:r[e4]));let o=n(new URL(e.href)),i=td(null==r?void 0:r.headers);return i.set("accept","application/json"),((null==r?void 0:r[te])||fetch)(o.href,{body:void 0,headers:Object.fromEntries(i.entries()),method:"GET",redirect:"manual",signal:th(o,null==r?void 0:r.signal)})}(e,"issuerIdentifier",e=>{switch(null==t?void 0:t.algorithm){case void 0:case"oidc":e.pathname=tp("".concat(e.pathname,"/").concat(".well-known/openid-configuration"));break;case"oauth2":!function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"/"===e.pathname?e.pathname=t:e.pathname=tp("".concat(t,"/").concat(n?e.pathname:e.pathname.replace(/(\/)$/,"")))}(e,".well-known/oauth-authorization-server");break;default:throw e9('"options.algorithm" must be "oidc" (default), or "oauth2"',"ERR_INVALID_ARG_VALUE")}return e},t)}function tf(e,t,n,r,o){try{if("number"!=typeof e||!Number.isFinite(e))throw e9("".concat(n," must be a number"),"ERR_INVALID_ARG_TYPE",o);if(e>0)return;if(t){if(0!==e)throw e9("".concat(n," must be a non-negative number"),"ERR_INVALID_ARG_VALUE",o);return}throw e9("".concat(n," must be a positive number"),"ERR_INVALID_ARG_VALUE",o)}catch(e){if(r)throw tl(e.message,r,o);throw e}}function ty(e,t,n,r){try{if("string"!=typeof e)throw e9("".concat(t," must be a string"),"ERR_INVALID_ARG_TYPE",r);if(0===e.length)throw e9("".concat(t," must not be empty"),"ERR_INVALID_ARG_VALUE",r)}catch(e){if(n)throw tl(e.message,n,r);throw e}}function tw(e){var t="application/json";if(tN(e)!==t)throw function(e){let t='"response" content-type must be ';for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(r.length>2){let e=r.pop();t+="".concat(r.join(", "),", or ").concat(e)}else 2===r.length?t+="".concat(r[0]," or ").concat(r[1]):t+=r[0];return tl(t,t9,e)}(e,t)}function tg(){return ta(crypto.getRandomValues(new Uint8Array(32)))}function tb(e){let t=null==e?void 0:e[e8];return"number"==typeof t&&Number.isFinite(t)?t:0}function tv(e){let t=null==e?void 0:e[e7];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function t_(){return Math.floor(Date.now()/1e3)}function tk(e){if("object"!=typeof e||null===e)throw e9('"as" must be an object',"ERR_INVALID_ARG_TYPE");ty(e.issuer,'"as.issuer"')}function tS(e){if("object"!=typeof e||null===e)throw e9('"client" must be an object',"ERR_INVALID_ARG_TYPE");ty(e.client_id,'"client.client_id"')}function tE(e){return ty(e,'"clientSecret"'),(t,n,r,o)=>{r.set("client_id",n.client_id),r.set("client_secret",e)}}let tA=URL.parse?(e,t)=>URL.parse(e,t):(e,t)=>{try{return new URL(e,t)}catch(e){return null}};function tT(e,t){if(t&&"https:"!==e.protocol)throw tl("only requests to HTTPS are allowed",t8,e);if("https:"!==e.protocol&&"http:"!==e.protocol)throw tl("only HTTP and HTTPS requests are allowed",t7,e)}function tP(e,t,n,r){let o;if("string"!=typeof e||!(o=tA(e)))throw tl("authorization server metadata does not contain a valid ".concat(n?'"as.mtls_endpoint_aliases.'.concat(t,'"'):'"as.'.concat(t,'"')),void 0===e?nr:no,{attribute:n?"mtls_endpoint_aliases.".concat(t):t});return tT(o,r),o}function tR(e,t,n,r){return n&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?tP(e.mtls_endpoint_aliases[t],t,n,r):tP(e[t],t,n,r)}class tI extends Error{constructor(e,t){var n;super(e,t),e0(this,"cause",void 0),e0(this,"code",void 0),e0(this,"error",void 0),e0(this,"status",void 0),e0(this,"error_description",void 0),e0(this,"response",void 0),this.name=this.constructor.name,this.code=t1,this.cause=t.cause,this.error=t.cause.error,this.status=t.response.status,this.error_description=t.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:t.response}),null==(n=Error.captureStackTrace)||n.call(Error,this,this.constructor)}}class tO extends Error{constructor(e,t){var n,r;super(e,t),e0(this,"cause",void 0),e0(this,"code",void 0),e0(this,"error",void 0),e0(this,"error_description",void 0),this.name=this.constructor.name,this.code=t5,this.cause=t.cause,this.error=t.cause.get("error"),this.error_description=null!=(n=t.cause.get("error_description"))?n:void 0,null==(r=Error.captureStackTrace)||r.call(Error,this,this.constructor)}}class tx extends Error{constructor(e,t){var n;super(e,t),e0(this,"cause",void 0),e0(this,"code",void 0),e0(this,"response",void 0),e0(this,"status",void 0),this.name=this.constructor.name,this.code=t0,this.cause=t.cause,this.status=t.response.status,this.response=t.response,Object.defineProperty(this,"response",{enumerable:!1}),null==(n=Error.captureStackTrace)||n.call(Error,this,this.constructor)}}let tC=RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)"),tj=RegExp('^[,\\s]*([a-zA-Z0-9!#$%&\\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*"((?:[^"\\\\]|\\\\[\\s\\S])*)"[,\\s]*(.*)'),tD=RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)[,\\s]*(.*)"),tL=RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+={0,2})(?:$|[,\\s])(.*)");async function tK(e,t,n){if(e.status!==t){var r;let t;if(function(e){let t;if(t=function(e){if(!e6(e,Response))throw e9('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");let t=e.headers.get("www-authenticate");if(null===t)return;let n=[],r=t;for(;r;){var o;let e,t=r.match(tC),i=null==(o=t)?void 0:o[1].toLowerCase();if(!i)return;let a=r.substring(t[0].length);if(a&&!a.match(/^[\s,]/))return;let s=a.match(/^\s+(.*)$/),c=!!s;r=s?s[1]:void 0;let l={};if(c)for(;r;){let n,o;if(t=r.match(tj)){if([,n,o,r]=t,o.includes("\\"))try{o=JSON.parse('"'.concat(o,'"'))}catch(e){}l[n.toLowerCase()]=o}else{if(!(t=r.match(tD))){if(t=r.match(tL)){if(Object.keys(l).length)break;[,e,r]=t;break}return}[,n,o,r]=t,l[n.toLowerCase()]=o}}else r=a||void 0;let u={scheme:i,parameters:l};e&&(u.token68=e),n.push(u)}return n.length?n:void 0}(e))throw new tx("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:t,response:e})}(e),t=await async function(e){if(e.status>399&&e.status<500){ni(e),tw(e);try{let t=await e.clone().json();if(tu(t)&&"string"==typeof t.error&&t.error.length)return t}catch(e){}}}(e))throw await (null==(r=e.body)?void 0:r.cancel()),new tI("server responded with an error in the response body",{cause:t,response:e});throw tl('"response" is not a conform '.concat(n," response (unexpected HTTP status code)"),t4,e)}}function tU(e){if(!tZ.has(e))throw e9('"options.DPoP" is not a valid DPoPHandle',"ERR_INVALID_ARG_VALUE")}function tN(e){var t;return null==(t=e.headers.get("content-type"))?void 0:t.split(";")[0]}async function tW(e,t,n,r,o,i,a){return await n(e,t,o,i),i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),((null==a?void 0:a[te])||fetch)(r.href,{body:o,headers:Object.fromEntries(i.entries()),method:"POST",redirect:"manual",signal:th(r,null==a?void 0:a.signal)})}async function tH(e,t,n,r,o,i){var a;let s=tR(e,"token_endpoint",t.use_mtls_endpoint_aliases,!0!==(null==i?void 0:i[e4]));o.set("grant_type",r);let c=td(null==i?void 0:i.headers);c.set("accept","application/json"),void 0!==(null==i?void 0:i.DPoP)&&(tU(i.DPoP),await i.DPoP.addProof(s,c,"POST"));let l=await tW(e,t,n,s,o,c,i);return null==i||null==(a=i.DPoP)||a.cacheNonce(l,s),l}let tz=new WeakMap,tJ=new WeakMap;function tM(e){if(!e.id_token)return;let t=tz.get(e);if(!t)throw e9('"ref" was already garbage collected or did not resolve from the proper sources',"ERR_INVALID_ARG_VALUE");return t}async function tV(e,t,n,r,o,i){if(tk(e),tS(t),!e6(n,Response))throw e9('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");await tK(n,200,"Token Endpoint"),ni(n);let a=await nh(n);if(ty(a.access_token,'"response" body "access_token" property',t6,{body:a}),ty(a.token_type,'"response" body "token_type" property',t6,{body:a}),a.token_type=a.token_type.toLowerCase(),void 0!==a.expires_in){let e="number"!=typeof a.expires_in?parseFloat(a.expires_in):a.expires_in;tf(e,!0,'"response" body "expires_in" property',t6,{body:a}),a.expires_in=e}if(void 0!==a.refresh_token&&ty(a.refresh_token,'"response" body "refresh_token" property',t6,{body:a}),void 0!==a.scope&&"string"!=typeof a.scope)throw tl('"response" body "scope" property must be a string',t6,{body:a});if(void 0!==a.id_token){ty(a.id_token,'"response" body "id_token" property',t6,{body:a});let i=["aud","exp","iat","iss","sub"];!0===t.require_auth_time&&i.push("auth_time"),void 0!==t.default_max_age&&(tf(t.default_max_age,!0,'"client.default_max_age"'),i.push("auth_time")),null!=r&&r.length&&i.push(...r);let{claims:s,jwt:c}=await (async function(e,t,n,r,o){let i,a,{0:s,1:c,length:l}=e.split(".");if(5===l){if(void 0===o)throw new ts("JWE decryption is not configured",{cause:e});e=await o(e),{0:s,1:c,length:l}=e.split(".")}if(3!==l)throw tl("Invalid JWT",t6,e);try{i=JSON.parse(ti(ta(s)))}catch(e){throw tl("failed to parse JWT Header body as base64url encoded JSON",t3,e)}if(!tu(i))throw tl("JWT Header must be a top level object",t6,e);if(t(i),void 0!==i.crit)throw new ts('no JWT "crit" header parameter extensions are supported',{cause:{header:i}});try{a=JSON.parse(ti(ta(c)))}catch(e){throw tl("failed to parse JWT Payload body as base64url encoded JSON",t3,e)}if(!tu(a))throw tl("JWT Payload must be a top level object",t6,e);let u=t_()+n;if(void 0!==a.exp){if("number"!=typeof a.exp)throw tl('unexpected JWT "exp" (expiration time) claim type',t6,{claims:a});if(a.exp<=u-r)throw tl('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',ne,{claims:a,now:u,tolerance:r,claim:"exp"})}if(void 0!==a.iat&&"number"!=typeof a.iat)throw tl('unexpected JWT "iat" (issued at) claim type',t6,{claims:a});if(void 0!==a.iss&&"string"!=typeof a.iss)throw tl('unexpected JWT "iss" (issuer) claim type',t6,{claims:a});if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw tl('unexpected JWT "nbf" (not before) claim type',t6,{claims:a});if(a.nbf>u+r)throw tl('unexpected JWT "nbf" (not before) claim value',ne,{claims:a,now:u,tolerance:r,claim:"nbf"})}if(void 0!==a.aud&&"string"!=typeof a.aud&&!Array.isArray(a.aud))throw tl('unexpected JWT "aud" (audience) claim type',t6,{claims:a});return{header:i,claims:a,jwt:e}})(a.id_token,nc.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported,"RS256"),tb(t),tv(t),o).then(tX.bind(void 0,i)).then(tF.bind(void 0,e)).then(tG.bind(void 0,t.client_id));if(Array.isArray(s.aud)&&1!==s.aud.length){if(void 0===s.azp)throw tl('ID Token "aud" (audience) claim includes additional untrusted audiences',nt,{claims:s,claim:"aud"});if(s.azp!==t.client_id)throw tl('unexpected ID Token "azp" (authorized party) claim value',nt,{expected:t.client_id,claims:s,claim:"azp"})}void 0!==s.auth_time&&tf(s.auth_time,!0,'ID Token "auth_time" (authentication time)',t6,{claims:s}),tJ.set(n,c),tz.set(a,s)}if(void 0!==(null==i?void 0:i[a.token_type]))i[a.token_type](n,a);else if("dpop"!==a.token_type&&"bearer"!==a.token_type)throw new ts("unsupported `token_type` value",{cause:{body:a}});return a}function tG(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw tl('unexpected JWT "aud" (audience) claim value',nt,{expected:e,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==e)throw tl('unexpected JWT "aud" (audience) claim value',nt,{expected:e,claims:t.claims,claim:"aud"});return t}function tF(e,t){var n,r;let o=null!=(n=null==(r=e[nm])?void 0:r.call(e,t))?n:e.issuer;if(t.claims.iss!==o)throw tl('unexpected JWT "iss" (issuer) claim value',nt,{expected:o,claims:t.claims,claim:"iss"});return t}let tZ=new WeakSet,tq=Symbol(),tB={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function tX(e,t){for(let n of e)if(void 0===t.claims[n])throw tl('JWT "'.concat(n,'" (').concat(tB[n],") claim missing"),t6,{claims:t.claims});return t}let tY=Symbol(),tQ=Symbol();async function t$(e,t,n,r){return"string"==typeof(null==r?void 0:r.expectedNonce)||"number"==typeof(null==r?void 0:r.maxAge)||null!=r&&r.requireIdToken?async function(e,t,n,r,o,i,a){let s=[];switch(r){case void 0:r=tY;break;case tY:break;default:ty(r,'"expectedNonce" argument'),s.push("nonce")}switch(null!=o||(o=t.default_max_age),o){case void 0:o=tQ;break;case tQ:break;default:tf(o,!0,'"maxAge" argument'),s.push("auth_time")}let c=await tV(e,t,n,s,i,a);ty(c.id_token,'"response" body "id_token" property',t6,{body:c});let l=tM(c);if(o!==tQ){let e=t_()+tb(t),n=tv(t);if(l.auth_time+o<e-n)throw tl("too much time has elapsed since the last End-User authentication",ne,{claims:l,now:e,tolerance:n,claim:"auth_time"})}if(r===tY){if(void 0!==l.nonce)throw tl('unexpected ID Token "nonce" claim value',nt,{expected:void 0,claims:l,claim:"nonce"})}else if(l.nonce!==r)throw tl('unexpected ID Token "nonce" claim value',nt,{expected:r,claims:l,claim:"nonce"});return c}(e,t,n,r.expectedNonce,r.maxAge,r[tn],r.recognizedTokenTypes):async function(e,t,n,r,o){let i=await tV(e,t,n,void 0,r,o),a=tM(i);if(a){if(void 0!==t.default_max_age){tf(t.default_max_age,!0,'"client.default_max_age"');let e=t_()+tb(t),n=tv(t);if(a.auth_time+t.default_max_age<e-n)throw tl("too much time has elapsed since the last End-User authentication",ne,{claims:a,now:e,tolerance:n,claim:"auth_time"})}if(void 0!==a.nonce)throw tl('unexpected ID Token "nonce" claim value',nt,{expected:void 0,claims:a,claim:"nonce"})}return i}(e,t,n,null==r?void 0:r[tn],null==r?void 0:r.recognizedTokenTypes)}let t0="OAUTH_WWW_AUTHENTICATE_CHALLENGE",t1="OAUTH_RESPONSE_BODY_ERROR",t2="OAUTH_UNSUPPORTED_OPERATION",t5="OAUTH_AUTHORIZATION_RESPONSE_ERROR",t3="OAUTH_PARSE_ERROR",t6="OAUTH_INVALID_RESPONSE",t9="OAUTH_RESPONSE_IS_NOT_JSON",t4="OAUTH_RESPONSE_IS_NOT_CONFORM",t8="OAUTH_HTTP_REQUEST_FORBIDDEN",t7="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",ne="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",nt="OAUTH_JWT_CLAIM_COMPARISON_FAILED",nn="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",nr="OAUTH_MISSING_SERVER_METADATA",no="OAUTH_INVALID_SERVER_METADATA";function ni(e){if(e.bodyUsed)throw e9('"response" body has been used already',"ERR_INVALID_ARG_VALUE")}function na(e){let{algorithm:t}=e;if("number"!=typeof t.modulusLength||t.modulusLength<2048)throw new ts("unsupported ".concat(t.name," modulusLength"),{cause:e})}async function ns(e){if("POST"!==e.method)throw e9("form_post responses are expected to use the POST method","ERR_INVALID_ARG_VALUE",{cause:e});if("application/x-www-form-urlencoded"!==tN(e))throw e9("form_post responses are expected to use the application/x-www-form-urlencoded content-type","ERR_INVALID_ARG_VALUE",{cause:e});return async function(e){if(e.bodyUsed)throw e9("form_post Request instances must contain a readable body","ERR_INVALID_ARG_VALUE",{cause:e});return e.text()}(e)}function nc(e,t,n,r){if(void 0===e)if(Array.isArray(t)){if(!t.includes(r.alg))throw tl('unexpected JWT "alg" header parameter',t6,{header:r,expected:t,reason:"authorization server metadata"})}else{if(void 0===n)throw tl('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:e,issuer:t,fallback:n});if("string"==typeof n?r.alg!==n:"function"==typeof n?!n(r.alg):!n.includes(r.alg))throw tl('unexpected JWT "alg" header parameter',t6,{header:r,expected:n,reason:"default value"})}else if("string"==typeof e?r.alg!==e:!e.includes(r.alg))throw tl('unexpected JWT "alg" header parameter',t6,{header:r,expected:e,reason:"client configuration"})}function nl(e,t){let{0:n,length:r}=e.getAll(t);if(r>1)throw tl('"'.concat(t,'" parameter must be provided only once'),t6);return n}let nu=Symbol(),nd=Symbol();async function nh(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tw;try{t=await e.json()}catch(t){throw n(e),tl('failed to parse "response" body as JSON',t3,t)}if(!tu(t))throw tl('"response" body must be a top level object',t6,{body:t});return t}let np=Symbol(),nm=Symbol(),nf=new TextEncoder,ny=new TextDecoder;function nw(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r>127)throw TypeError("non-ASCII string encountered in encode()");t[n]=r}return t}function ng(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}function nb(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof e?e:ny.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=ny.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return ng(t)}catch(e){throw TypeError("The input to be decoded is not correctly encoded.")}}class nv extends Error{constructor(e,t){var n;super(e,t),e0(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,null==(n=Error.captureStackTrace)||n.call(Error,this,this.constructor)}}e0(nv,"code","ERR_JOSE_GENERIC");class n_ extends nv{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(e,{cause:{claim:n,reason:r,payload:t}}),e0(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),e0(this,"claim",void 0),e0(this,"reason",void 0),e0(this,"payload",void 0),this.claim=n,this.reason=r,this.payload=t}}e0(n_,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class nk extends nv{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unspecified",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unspecified";super(e,{cause:{claim:n,reason:r,payload:t}}),e0(this,"code","ERR_JWT_EXPIRED"),e0(this,"claim",void 0),e0(this,"reason",void 0),e0(this,"payload",void 0),this.claim=n,this.reason=r,this.payload=t}}e0(nk,"code","ERR_JWT_EXPIRED");class nS extends nv{constructor(){super(...arguments),e0(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}e0(nS,"code","ERR_JOSE_ALG_NOT_ALLOWED");class nE extends nv{constructor(){super(...arguments),e0(this,"code","ERR_JOSE_NOT_SUPPORTED")}}e0(nE,"code","ERR_JOSE_NOT_SUPPORTED"),e0(class extends nv{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"decryption operation failed",arguments.length>1?arguments[1]:void 0),e0(this,"code","ERR_JWE_DECRYPTION_FAILED")}},"code","ERR_JWE_DECRYPTION_FAILED"),e0(class extends nv{constructor(){super(...arguments),e0(this,"code","ERR_JWE_INVALID")}},"code","ERR_JWE_INVALID");class nA extends nv{constructor(){super(...arguments),e0(this,"code","ERR_JWS_INVALID")}}e0(nA,"code","ERR_JWS_INVALID");class nT extends nv{constructor(){super(...arguments),e0(this,"code","ERR_JWT_INVALID")}}e0(nT,"code","ERR_JWT_INVALID"),e0(class extends nv{constructor(){super(...arguments),e0(this,"code","ERR_JWK_INVALID")}},"code","ERR_JWK_INVALID");class nP extends nv{constructor(){super(...arguments),e0(this,"code","ERR_JWKS_INVALID")}}e0(nP,"code","ERR_JWKS_INVALID");class nR extends nv{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no applicable key found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),e0(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}e0(nR,"code","ERR_JWKS_NO_MATCHING_KEY");class nI extends nv{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"multiple matching keys found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),e0(this,Symbol.asyncIterator,void 0),e0(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}e0(nI,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class nO extends nv{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"request timed out",arguments.length>1?arguments[1]:void 0),e0(this,"code","ERR_JWKS_TIMEOUT")}}e0(nO,"code","ERR_JWKS_TIMEOUT");class nx extends nv{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"signature verification failed",arguments.length>1?arguments[1]:void 0),e0(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}e0(nx,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");let nC=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"algorithm.name";return TypeError("CryptoKey does not support this operation, its ".concat(t," must be ").concat(e))};function nj(e){return parseInt(e.name.slice(4),10)}function nD(e,t){for(var n,r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];if((o=o.filter(Boolean)).length>2){let t=o.pop();e+="one of type ".concat(o.join(", "),", or ").concat(t,".")}else 2===o.length?e+="one of type ".concat(o[0]," or ").concat(o[1],"."):e+="of type ".concat(o[0],".");return null==t?e+=" Received ".concat(t):"function"==typeof t&&t.name?e+=" Received function ".concat(t.name):"object"==typeof t&&null!=t&&null!=(n=t.constructor)&&n.name&&(e+=" Received an instance of ".concat(t.constructor.name)),e}let nL=function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return nD("Key for the ".concat(e," algorithm must be "),t,...r)},nK=e=>{if("CryptoKey"===(null==e?void 0:e[Symbol.toStringTag]))return!0;try{return e instanceof CryptoKey}catch(e){return!1}},nU=e=>"KeyObject"===(null==e?void 0:e[Symbol.toStringTag]),nN=e=>nK(e)||nU(e);function nW(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}let nH=(e,t)=>{if(e.byteLength!==t.length)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0},nz=e=>{let t=e.data[e.pos++];if(128&t){let n=127&t,r=0;for(let t=0;t<n;t++)r=r<<8|e.data[e.pos++];return r}return t},nJ=(e,t,n)=>{if(e.data[e.pos++]!==t)throw Error(n)},nM=(e,t)=>{let n=e.data.subarray(e.pos,e.pos+t);return e.pos+=t,n},nV=async(e,t,n,r)=>{var o;let i,a,s="spki"===e,c=()=>s?["verify"]:["sign"];switch(n){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:"SHA-".concat(n.slice(-3))},a=c();break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(n.slice(-3))},a=c();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(n.slice(-3),10)||1)},a=s?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":i={name:"ECDSA",namedCurve:({ES256:"P-256",ES384:"P-384",ES512:"P-521"})[n]},a=c();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{let e=r.getNamedCurve(t);i="X25519"===e?{name:"X25519"}:{name:"ECDH",namedCurve:e}}catch(e){throw new nE("Invalid or unsupported key format")}a=s?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":i={name:"Ed25519"},a=c();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":i={name:n},a=c();break;default:throw new nE('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(e,t,i,null!=(o=null==r?void 0:r.extractable)?o:!!s,a)};async function nG(e){var t,n;if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:r,keyUsages:o}=function(e){let t,n;switch(e.kty){case"AKP":switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},n=e.priv?["sign"]:["verify"];break;default:throw new nE('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:"SHA-".concat(e.alg.slice(-3))},n=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(e.alg.slice(-3))},n=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(e.alg.slice(-3),10)||1)},n=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new nE('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},n=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},n=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new nE('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new nE('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new nE('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:n}}(e),i=e2({},e);return"AKP"!==i.kty&&delete i.alg,delete i.use,crypto.subtle.importKey("jwk",i,r,null!=(t=e.ext)?t:!e.d&&!e.priv,null!=(n=e.key_ops)?n:o)}let nF=e=>nW(e)&&"string"==typeof e.kty,nZ=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];o||(o=new WeakMap);let i=o.get(e);if(null!=i&&i[n])return i[n];let a=await nG(e2(e2({},t),{},{alg:n}));return r&&Object.freeze(e),i?i[n]=a:o.set(e,{[n]:a}),a};async function nq(e,t){if(e instanceof Uint8Array||nK(e))return e;if(nU(e)){if("secret"===e.type)return e.export();if("toCryptoKey"in e&&"function"==typeof e.toCryptoKey)try{return((e,t)=>{let n;o||(o=new WeakMap);let r=o.get(e);if(null!=r&&r[t])return r[t];let i="public"===e.type,a=!!i;if("x25519"===e.asymmetricKeyType){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}n=e.toCryptoKey(e.asymmetricKeyType,a,i?[]:["deriveBits"])}if("ed25519"===e.asymmetricKeyType){if("EdDSA"!==t&&"Ed25519"!==t)throw TypeError("given KeyObject instance cannot be used for this algorithm");n=e.toCryptoKey(e.asymmetricKeyType,a,[i?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(t!==e.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");n=e.toCryptoKey(e.asymmetricKeyType,a,[i?"verify":"sign"])}if("rsa"===e.asymmetricKeyType){let r;switch(t){case"RSA-OAEP":r="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":r="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":r="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":r="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:r},a,i?["encrypt"]:["decrypt"]);n=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:r},a,[i?"verify":"sign"])}if("ec"===e.asymmetricKeyType){var s;let r=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(null==(s=e.asymmetricKeyDetails)?void 0:s.namedCurve);if(!r)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===t&&"P-256"===r&&(n=e.toCryptoKey({name:"ECDSA",namedCurve:r},a,[i?"verify":"sign"])),"ES384"===t&&"P-384"===r&&(n=e.toCryptoKey({name:"ECDSA",namedCurve:r},a,[i?"verify":"sign"])),"ES512"===t&&"P-521"===r&&(n=e.toCryptoKey({name:"ECDSA",namedCurve:r},a,[i?"verify":"sign"])),t.startsWith("ECDH-ES")&&(n=e.toCryptoKey({name:"ECDH",namedCurve:r},a,i?[]:["deriveBits"]))}if(!n)throw TypeError("given KeyObject instance cannot be used for this algorithm");return r?r[t]=n:o.set(e,{[t]:n}),n})(e,t)}catch(e){if(e instanceof TypeError)throw e}let n=e.export({format:"jwk"});return nZ(e,n,t)}if(nF(e))return e.k?nb(e.k):nZ(e,e,t,!0);throw Error("unreachable")}let nB=e=>null==e?void 0:e[Symbol.toStringTag],nX=(e,t,n)=>{if(void 0!==t.use){let e;switch(n){case"sign":case"verify":e="sig";break;case"encrypt":case"decrypt":e="enc"}if(t.use!==e)throw TypeError('Invalid key for this operation, its "use" must be "'.concat(e,'" when present'))}if(void 0!==t.alg&&t.alg!==e)throw TypeError('Invalid key for this operation, its "alg" must be "'.concat(e,'" when present'));if(Array.isArray(t.key_ops)){var r,o;let i;switch(!0){case"sign"===n||"verify"===n:case"dir"===e:case e.includes("CBC-HS"):i=n;break;case e.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):i=!e.includes("GCM")&&e.endsWith("KW")?"encrypt"===n?"wrapKey":"unwrapKey":n;break;case"encrypt"===n&&e.startsWith("RSA"):i="wrapKey";break;case"decrypt"===n:i=e.startsWith("RSA")?"unwrapKey":"deriveBits"}if(i&&!1===(null==(r=t.key_ops)||null==(o=r.includes)?void 0:o.call(r,i)))throw TypeError('Invalid key for this operation, its "key_ops" must include "'.concat(i,'" when present'))}return!0};function nY(e){return void 0!==e?tE(e):(s||(s=new WeakMap),(e,t,n,r)=>{let o;return(o=s.get(t))||(!function(e,t){if("string"!=typeof e)throw n0("".concat(t," must be a string"),n$);if(0===e.length)throw n0("".concat(t," must not be empty"),nQ)}(t.client_secret,'"metadata.client_secret"'),o=tE(t.client_secret),s.set(t,o)),o(e,t,n,r)})}("u"<typeof navigator||null==(rA=navigator.userAgent)||null==(rT=rA.startsWith)||!rT.call(rA,"Mozilla/5.0 "))&&(i={"user-agent":"".concat("openid-client","/").concat("v6.8.1")});let nQ="ERR_INVALID_ARG_VALUE",n$="ERR_INVALID_ARG_TYPE";function n0(e,t,n){let r=TypeError(e,{cause:n});return Object.assign(r,{code:t}),r}class n1 extends Error{constructor(e,t){var n;super(e,t),e0(this,"code",void 0),this.name=this.constructor.name,this.code=null==t?void 0:t.code,null==(n=Error.captureStackTrace)||n.call(Error,this,this.constructor)}}function n2(e,t,n){return new n1(e,{cause:t,code:n})}function n5(e){if(e instanceof TypeError||e instanceof n1||e instanceof tI||e instanceof tO||e instanceof tx)throw e;if(e instanceof tc)switch(e.code){case t8:throw n2("only requests to HTTPS are allowed",e,e.code);case t7:throw n2("only requests to HTTP or HTTPS are allowed",e,e.code);case t4:throw n2("unexpected HTTP response status code",e.cause,e.code);case t9:throw n2("unexpected response content-type",e.cause,e.code);case t3:throw n2("parsing error occured",e,e.code);case t6:throw n2("invalid response encountered",e,e.code);case nt:throw n2("unexpected JWT claim value encountered",e,e.code);case nn:throw n2("unexpected JSON attribute value encountered",e,e.code);case ne:throw n2("JWT timestamp claim value failed validation",e,e.code);default:throw n2(e.message,e,e.code)}if(e instanceof ts)throw n2("unsupported operation",e,e.code);if(e instanceof DOMException)switch(e.name){case"OperationError":throw n2("runtime operation error",e,t2);case"NotSupportedError":throw n2("runtime unsupported operation",e,t2);case"TimeoutError":throw n2("operation timed out",e,"OAUTH_TIMEOUT");case"AbortError":throw n2("operation aborted",e,"OAUTH_ABORT")}throw new n1("something went wrong",{cause:e})}async function n3(e,t,n,r,o){let s=new n9(await async function(e,t){var n,r,o;if(!(e instanceof URL))throw n0('"server" must be an instance of URL',n$);let a=!e.href.includes("/.well-known/"),s=null!=(n=null==t?void 0:t.timeout)?n:30,c=AbortSignal.timeout(1e3*s),l=await (a?tm(e,{algorithm:null==t?void 0:t.algorithm,[te]:null==t?void 0:t[te],[e4]:null==t||null==(r=t.execute)?void 0:r.includes(rn),signal:c,headers:new Headers(i)}):((null==t?void 0:t[te])||fetch)((tT(e,null==t||null==(o=t.execute)||!o.includes(rn)),e.href),{headers:Object.fromEntries(new Headers(e2({accept:"application/json"},i)).entries()),body:void 0,method:"GET",redirect:"manual",signal:c})).then(e=>(async function(e,t){if(!(e instanceof URL)&&e!==np)throw e9('"expectedIssuerIdentifier" must be an instance of URL',"ERR_INVALID_ARG_TYPE");if(!e6(t,Response))throw e9('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");if(200!==t.status)throw tl('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',t4,t);ni(t);let n=await nh(t);if(ty(n.issuer,'"response" body "issuer" property',t6,{body:n}),e!==np&&new URL(n.issuer).href!==e.href)throw tl('"response" body "issuer" property does not match the expected value',nn,{expected:e.href,body:n,attribute:"issuer"});return n})(np,e)).catch(n5);return a&&new URL(l.issuer).href!==e.href&&("https://login.microsoftonline.com"!==e.origin||null!=t&&t.algorithm&&"oidc"!==t.algorithm||(l[n6]=!0,0))&&(!e.hostname.endsWith(".b2clogin.com")||null!=t&&t.algorithm&&"oidc"!==t.algorithm)&&(()=>{throw new n1("discovered metadata issuer does not match the expected issuer",{code:nn,cause:{expected:e.href,body:l,attribute:"issuer"}})})(),l}(e,o),t,n,r),c=a.get(s);if(null!=o&&o[te]&&(c.fetch=o[te]),null!=o&&o.timeout&&(c.timeout=o.timeout),null!=o&&o.execute)for(let e of o.execute)e(s);return s}new TextDecoder;let n6=Symbol();class n9{constructor(e,t,n,r){var o,i,s,c,l;let u;if("string"!=typeof t||!t.length)throw n0('"clientId" must be a non-empty string',n$);if("string"==typeof n&&(n={client_secret:n}),void 0!==(null==(o=n)?void 0:o.client_id)&&t!==n.client_id)throw n0('"clientId" and "metadata.client_id" must be the same',nQ);let d=e2(e2({},structuredClone(n)),{},{client_id:t});d[e8]=null!=(i=null==(s=n)?void 0:s[e8])?i:0,d[e7]=null!=(c=null==(l=n)?void 0:l[e7])?c:30,u=r||("string"==typeof d.client_secret&&d.client_secret.length?nY(d.client_secret):(e,t,n,r)=>{n.set("client_id",t.client_id)});let h=Object.freeze(d),p=structuredClone(e);n6 in e&&(p[nm]=t=>{let{claims:{tid:n}}=t;return e.issuer.replace("{tenantid}",n)});let m=Object.freeze(p);a||(a=new WeakMap),a.set(this,{__proto__:null,as:m,c:h,auth:u,tlsOnly:!0,jwksCache:{}})}serverMetadata(){let e=structuredClone(a.get(this).as);return Object.defineProperties(e,{supportsPKCE:{__proto__:null,value(){var t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"S256";return!0===(null==(t=e.code_challenge_methods_supported)?void 0:t.includes(n))}}}),e}clientMetadata(){return structuredClone(a.get(this).c)}get timeout(){return a.get(this).timeout}set timeout(e){a.get(this).timeout=e}get[te](){return a.get(this).fetch}set[te](e){a.get(this).fetch=e}}function n4(e){Object.defineProperties(e,function(e){let t;if(void 0!==e.expires_in){let n=new Date;n.setSeconds(n.getSeconds()+e.expires_in),t=n.getTime()}return{expiresIn:{__proto__:null,value(){if(t){let e=Date.now();return t>e?Math.floor((t-e)/1e3):0}}},claims:{__proto__:null,value(){try{return tM(this)}catch(e){return}}}}}(e))}async function n8(e,t,n){var r;let o,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=null==(r=e.headers.get("retry-after"))?void 0:r.trim();if(void 0!==a){if(/^\d+$/.test(a))o=parseInt(a,10);else{let e=new Date(a);if(Number.isFinite(e.getTime())){let t=new Date,n=e.getTime()-t.getTime();n>0&&(o=Math.ceil(n/1e3))}}if(i&&!Number.isFinite(o))throw new tc("invalid Retry-After header value",{cause:e});o>t&&await n7(o-t,n)}}function n7(e,t){return new Promise((n,r)=>{let o=e=>{try{t.throwIfAborted()}catch(e){return void r(e)}if(e<=0)return void n();let i=Math.min(e,5);setTimeout(()=>o(e-i),1e3*i)};o(e)})}async function re(e,t){rc(e);let{as:n,c:r,auth:o,fetch:s,tlsOnly:c,timeout:l}=a.get(e);return(async function(e,t,n,r,o){tk(e),tS(t);let i=tR(e,"backchannel_authentication_endpoint",t.use_mtls_endpoint_aliases,!0!==(null==o?void 0:o[e4])),a=new URLSearchParams(r);a.set("client_id",t.client_id);let s=td(null==o?void 0:o.headers);return s.set("accept","application/json"),tW(e,t,n,i,a,s,o)})(n,r,o,t,{[te]:s,[e4]:!c,headers:new Headers(i),signal:rl(l)}).then(e=>(async function(e,t,n){if(tk(e),tS(t),!e6(n,Response))throw e9('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");await tK(n,200,"Backchannel Authentication Endpoint"),ni(n);let r=await nh(n);ty(r.auth_req_id,'"response" body "auth_req_id" property',t6,{body:r});let o="number"!=typeof r.expires_in?parseFloat(r.expires_in):r.expires_in;return tf(o,!0,'"response" body "expires_in" property',t6,{body:r}),r.expires_in=o,void 0!==r.interval&&tf(r.interval,!1,'"response" body "interval" property',t6,{body:r}),r})(n,r,e)).catch(n5)}async function rt(e,t,n,r){var o,s,c;let l;rc(e),n=new URLSearchParams(n);let u=null!=(o=t.interval)?o:5,d=null!=(s=null==r?void 0:r.signal)?s:AbortSignal.timeout(1e3*t.expires_in);try{await n7(u,d)}catch(e){n5(e)}let{as:h,c:p,auth:m,fetch:f,tlsOnly:y,nonRepudiation:w,timeout:g,decrypt:b}=a.get(e),v=(o,i)=>rt(e,e2(e2({},t),{},{interval:o}),n,e2(e2({},r),{},{signal:d,flag:i})),_=await (async function(e,t,n,r,o){tk(e),tS(t),ty(r,'"authReqId"');let i=new URLSearchParams(null==o?void 0:o.additionalParameters);return i.set("auth_req_id",r),tH(e,t,n,"urn:openid:params:grant-type:ciba",i,o)})(h,p,m,t.auth_req_id,{[te]:f,[e4]:!y,additionalParameters:n,DPoP:null==r?void 0:r.DPoP,headers:new Headers(i),signal:d.aborted?d:rl(g)}).catch(n5);if(503===_.status&&_.headers.has("retry-after"))return await n8(_,u,d,!0),await (null==(c=_.body)?void 0:c.cancel()),v(u);let k=async function(e,t,n,r){return tV(e,t,n,void 0,null==r?void 0:r[tn],null==r?void 0:r.recognizedTokenTypes)}(h,p,_,{[tn]:b});try{l=await k}catch(e){if(ru(e,r))return v(u,rd);if(e instanceof tI)switch(e.error){case"slow_down":u+=5;case"authorization_pending":return await n8(e.response,u,d),v(u)}n5(e)}return l.id_token&&await (null==w?void 0:w(_)),n4(l),l}function rn(e){a.get(e).tlsOnly=!1}async function rr(e,t,n,r,o){let s,c,l;if(rc(e),!((null==o?void 0:o.flag)===rd||t instanceof URL||function(e,t){try{return Object.getPrototypeOf(e)[Symbol.toStringTag]===t}catch(e){return!1}}(t,"Request")))throw n0('"currentUrl" must be an instance of URL, or Request',n$);let{as:u,c:d,auth:h,fetch:p,tlsOnly:m,jarm:f,hybrid:y,nonRepudiation:w,timeout:g,decrypt:b,implicit:v}=a.get(e);if((null==o?void 0:o.flag)===rd)s=o.authResponse,c=o.redirectUri;else{var _;if(!(t instanceof URL)){let e=t;switch(t=new URL(t.url),e.method){case"GET":break;case"POST":let n=new URLSearchParams(await ns(e));if(y)t.hash=n.toString();else for(let[e,r]of n.entries())t.searchParams.append(e,r);break;default:throw n0("unexpected Request HTTP method",nQ)}}switch((_=new URL(_=t)).search="",_.hash="",c=_.href,!0){case!!f:s=await f(t,null==n?void 0:n.expectedState);break;case!!y:s=await y(t,null==n?void 0:n.expectedNonce,null==n?void 0:n.expectedState,null==n?void 0:n.maxAge);break;case!!v:throw TypeError("authorizationCodeGrant() cannot be used by response_type=id_token clients");default:try{s=function(e,t,n,r){var o;if(tk(e),tS(t),n instanceof URL&&(n=n.searchParams),!(n instanceof URLSearchParams))throw e9('"parameters" must be an instance of URLSearchParams, or URL',"ERR_INVALID_ARG_TYPE");if(nl(n,"response"))throw tl('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',t6,{parameters:n});let i=nl(n,"iss"),a=nl(n,"state");if(!i&&e.authorization_response_iss_parameter_supported)throw tl('response parameter "iss" (issuer) missing',t6,{parameters:n});if(i&&i!==e.issuer)throw tl('unexpected "iss" (issuer) response parameter value',t6,{expected:e.issuer,parameters:n});switch(r){case void 0:case nd:if(void 0!==a)throw tl('unexpected "state" response parameter encountered',t6,{expected:void 0,parameters:n});break;case nu:break;default:if(ty(r,'"expectedState" argument'),a!==r)throw tl(void 0===a?'response parameter "state" missing':'unexpected "state" response parameter value',t6,{expected:r,parameters:n})}if(nl(n,"error"))throw new tO("authorization response from the server is an error",{cause:n});let s=nl(n,"id_token"),c=nl(n,"token");if(void 0!==s||void 0!==c)throw new ts("implicit and hybrid flows are not supported");return o=new URLSearchParams(n),tZ.add(o),o}(u,d,t.searchParams,null==n?void 0:n.expectedState)}catch(e){n5(e)}}}let k=await (async function(e,t,n,r,o,i,a){if(tk(e),tS(t),!tZ.has(r))throw e9('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',"ERR_INVALID_ARG_VALUE");ty(o,'"redirectUri"');let s=nl(r,"code");if(!s)throw tl('no authorization code in "callbackParameters"',t6);let c=new URLSearchParams(null==a?void 0:a.additionalParameters);return c.set("redirect_uri",o),c.set("code",s),i!==tq&&(ty(i,'"codeVerifier"'),c.set("code_verifier",i)),tH(e,t,n,"authorization_code",c,a)})(u,d,h,s,c,(null==n?void 0:n.pkceCodeVerifier)||tq,{additionalParameters:r,[te]:p,[e4]:!m,DPoP:null==o?void 0:o.DPoP,headers:new Headers(i),signal:rl(g)}).catch(n5);"string"!=typeof(null==n?void 0:n.expectedNonce)&&"number"!=typeof(null==n?void 0:n.maxAge)||(n.idTokenExpected=!0);let S=t$(u,d,k,{expectedNonce:null==n?void 0:n.expectedNonce,maxAge:null==n?void 0:n.maxAge,requireIdToken:null==n?void 0:n.idTokenExpected,[tn]:b});try{l=await S}catch(t){if(ru(t,o))return rr(e,void 0,n,r,e2(e2({},o),{},{flag:rd,authResponse:s,redirectUri:c}));n5(t)}return l.id_token&&await (null==w?void 0:w(k)),n4(l),l}async function ro(e,t,n,r){let o;rc(e),n=new URLSearchParams(n);let{as:s,c:c,auth:l,fetch:u,tlsOnly:d,nonRepudiation:h,timeout:p,decrypt:m}=a.get(e),f=await (async function(e,t,n,r,o){tk(e),tS(t),ty(r,'"refreshToken"');let i=new URLSearchParams(null==o?void 0:o.additionalParameters);return i.set("refresh_token",r),tH(e,t,n,"refresh_token",i,o)})(s,c,l,t,{[te]:u,[e4]:!d,additionalParameters:n,DPoP:null==r?void 0:r.DPoP,headers:new Headers(i),signal:rl(p)}).catch(n5),y=async function(e,t,n,r){return tV(e,t,n,void 0,null==r?void 0:r[tn],null==r?void 0:r.recognizedTokenTypes)}(s,c,f,{[tn]:m});try{o=await y}catch(o){if(ru(o,r))return ro(e,t,n,e2(e2({},r),{},{flag:rd}));n5(o)}return o.id_token&&await (null==h?void 0:h(f)),n4(o),o}async function ri(e,t,n){let r;rc(e),t=new URLSearchParams(t);let{as:o,c:s,auth:c,fetch:l,tlsOnly:u,timeout:d}=a.get(e),h=await (async function(e,t,n,r,o){return tk(e),tS(t),tH(e,t,n,"client_credentials",new URLSearchParams(r),o)})(o,s,c,t,{[te]:l,[e4]:!u,DPoP:null==n?void 0:n.DPoP,headers:new Headers(i),signal:rl(d)}).catch(n5),p=async function(e,t,n){return tV(e,t,n,void 0,void 0,void 0)}(o,s,h);try{r=await p}catch(r){if(ru(r,n))return ri(e,t,e2(e2({},n),{},{flag:rd}));n5(r)}return n4(r),r}function ra(e,t){rc(e);let{as:n,c:r,tlsOnly:o,hybrid:i,jarm:s,implicit:c}=a.get(e),l=tR(n,"authorization_endpoint",!1,o);if((t=new URLSearchParams(t)).has("client_id")||t.set("client_id",r.client_id),!t.has("request_uri")&&!t.has("request")){if(t.has("response_type")||t.set("response_type",i?"code id_token":c?"id_token":"code"),c&&!t.has("nonce"))throw n0("response_type=id_token clients must provide a nonce parameter in their authorization request parameters",nQ);s&&t.set("response_mode","jwt")}for(let[e,n]of t.entries())l.searchParams.append(e,n);return l}async function rs(e,t,n){let r;rc(e);let o=ra(e,t),{as:s,c:c,auth:l,fetch:u,tlsOnly:d,timeout:h}=a.get(e),p=await (async function(e,t,n,r,o){var i;tk(e),tS(t);let a=tR(e,"pushed_authorization_request_endpoint",t.use_mtls_endpoint_aliases,!0!==(null==o?void 0:o[e4])),s=new URLSearchParams(r);s.set("client_id",t.client_id);let c=td(null==o?void 0:o.headers);c.set("accept","application/json"),void 0!==(null==o?void 0:o.DPoP)&&(tU(o.DPoP),await o.DPoP.addProof(a,c,"POST"));let l=await tW(e,t,n,a,s,c,o);return null==o||null==(i=o.DPoP)||i.cacheNonce(l,a),l})(s,c,l,o.searchParams,{[te]:u,[e4]:!d,DPoP:null==n?void 0:n.DPoP,headers:new Headers(i),signal:rl(h)}).catch(n5),m=async function(e,t,n){if(tk(e),tS(t),!e6(n,Response))throw e9('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");await tK(n,201,"Pushed Authorization Request Endpoint"),ni(n);let r=await nh(n);ty(r.request_uri,'"response" body "request_uri" property',t6,{body:r});let o="number"!=typeof r.expires_in?parseFloat(r.expires_in):r.expires_in;return tf(o,!0,'"response" body "expires_in" property',t6,{body:r}),r.expires_in=o,r}(s,c,p);try{r=await m}catch(r){if(ru(r,n))return rs(e,t,e2(e2({},n),{},{flag:rd}));n5(r)}return ra(e,{request_uri:r.request_uri})}function rc(e){if(!(e instanceof n9))throw n0('"config" must be an instance of Configuration',n$);if(Object.getPrototypeOf(e)!==n9.prototype)throw n0("subclassing Configuration is not allowed",nQ)}function rl(e){return e?AbortSignal.timeout(1e3*e):void 0}function ru(e,t){return!(null==t||!t.DPoP||t.flag===rd)&&function(e){if(e instanceof tx){let{0:t,length:n}=e.cause;return 1===n&&"dpop"===t.scheme&&"use_dpop_nonce"===t.parameters.error}return e instanceof tI&&"use_dpop_nonce"===e.error}(e)}Object.freeze(n9.prototype);let rd=Symbol();async function rh(e,t,n,r){rc(e);let{as:o,c:s,auth:c,fetch:l,tlsOnly:u,timeout:d,decrypt:h}=a.get(e),p=await (async function(e,t,n,r,o,i){return tk(e),tS(t),ty(r,'"grantType"'),tH(e,t,n,r,new URLSearchParams(o),i)})(o,s,c,t,new URLSearchParams(n),{[te]:l,[e4]:!u,DPoP:null==r?void 0:r.DPoP,headers:new Headers(i),signal:rl(d)}).then(e=>{let n;return"urn:ietf:params:oauth:grant-type:token-exchange"===t&&(n={n_a:()=>{}}),async function(e,t,n,r){return tV(e,t,n,void 0,null==r?void 0:r[tn],null==r?void 0:r.recognizedTokenTypes)}(o,s,e,{[tn]:h,recognizedTokenTypes:n})}).catch(n5);return n4(p),p}async function rp(e,t,n){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return nD("Key must be ",e,...n)}(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:"SHA-".concat(e.slice(-3)),name:"HMAC"},!1,[n])}return function(e,t,n){switch(t){case"HS256":case"HS384":case"HS512":{if("HMAC"!==e.algorithm.name)throw nC("HMAC");let n=parseInt(t.slice(2),10);if(nj(e.algorithm.hash)!==n)throw nC("SHA-".concat(n),"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if("RSASSA-PKCS1-v1_5"!==e.algorithm.name)throw nC("RSASSA-PKCS1-v1_5");let n=parseInt(t.slice(2),10);if(nj(e.algorithm.hash)!==n)throw nC("SHA-".concat(n),"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if("RSA-PSS"!==e.algorithm.name)throw nC("RSA-PSS");let n=parseInt(t.slice(2),10);if(nj(e.algorithm.hash)!==n)throw nC("SHA-".concat(n),"algorithm.hash");break}case"Ed25519":case"EdDSA":if("Ed25519"!==e.algorithm.name)throw nC("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":let r;if(r=e.algorithm,r.name!==t)throw nC(t);break;case"ES256":case"ES384":case"ES512":{if("ECDSA"!==e.algorithm.name)throw nC("ECDSA");let n=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==n)throw nC(n,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(n&&!e.usages.includes(n))throw TypeError("CryptoKey does not support this operation, its usages must include ".concat(n,"."))}(t,e,n),t}async function rm(e,t,n,r){let o=await rp(e,t,"verify");!function(e,t){if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:n}=t.algorithm;if("number"!=typeof n||n<2048)throw TypeError("".concat(e," requires key modulusLength to be 2048 bits or larger"))}}(e,o);let i=function(e,t){let n="SHA-".concat(e.slice(-3));switch(e){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new nE("alg ".concat(e," is not supported either by JOSE or your javascript runtime"))}}(e,o.algorithm);try{return await crypto.subtle.verify(i,o,n,r)}catch(e){return!1}}async function rf(e,t,n){let r,o;if(!nW(e))throw new nA("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new nA('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new nA("JWS Protected Header incorrect type");if(void 0===e.payload)throw new nA("JWS Payload missing");if("string"!=typeof e.signature)throw new nA("JWS Signature missing or incorrect type");if(void 0!==e.header&&!nW(e.header))throw new nA("JWS Unprotected Header incorrect type");let i={};if(e.protected)try{let t=nb(e.protected);i=JSON.parse(ny.decode(t))}catch(e){throw new nA("JWS Protected Header is invalid")}if(!function(){let e;for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];let o=n.filter(Boolean);if(0===o.length||1===o.length)return!0;for(let t of o){let n=Object.keys(t);if(e&&0!==e.size)for(let t of n){if(e.has(t))return!1;e.add(t)}else e=new Set(n)}return!0}(i,e.header))throw new nA("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let a=e2(e2({},i),e.header),s=function(e,t,n,r,o){let i;if(void 0!==o.crit&&void 0===(null==r?void 0:r.crit))throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||void 0===r.crit)return new Set;if(!Array.isArray(r.crit)||0===r.crit.length||r.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let a of(i=void 0!==n?new Map([...Object.entries(n),...t.entries()]):t,r.crit)){if(!i.has(a))throw new nE('Extension Header Parameter "'.concat(a,'" is not recognized'));if(void 0===o[a])throw new e('Extension Header Parameter "'.concat(a,'" is missing'));if(i.get(a)&&void 0===r[a])throw new e('Extension Header Parameter "'.concat(a,'" MUST be integrity protected'))}return new Set(r.crit)}(nA,new Map([["b64",!0]]),null==n?void 0:n.crit,i,a),c=!0;if(s.has("b64")&&"boolean"!=typeof(c=i.b64))throw new nA('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=a;if("string"!=typeof l||!l)throw new nA('JWS "alg" (Algorithm) Header Parameter missing or invalid');let u=n&&function(e,t){if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError('"'.concat(e,'" option must be an array of strings'));if(t)return new Set(t)}("algorithms",n.algorithms);if(u&&!u.has(l))throw new nS('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new nA("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new nA("JWS Payload must be a string or an Uint8Array instance");let d=!1;"function"==typeof t&&(t=await t(i,e),d=!0),function(e,t,n){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((e,t,n)=>{if(!(t instanceof Uint8Array)){if(nF(t)){if("oct"===t.kty&&"string"==typeof t.k&&nX(e,t,n))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!nN(t))throw TypeError(nL(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==t.type)throw TypeError("".concat(nB(t),' instances for symmetric algorithms must be of type "secret"'))}})(e,t,n);break;default:((e,t,n)=>{if(nF(t))switch(n){case"decrypt":case"sign":if("oct"!==t.kty&&("AKP"===t.kty&&"string"==typeof t.priv||"string"==typeof t.d)&&nX(e,t,n))return;throw TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if("oct"!==t.kty&&void 0===t.d&&void 0===t.priv&&nX(e,t,n))return;throw TypeError("JSON Web Key for this operation must be a public JWK")}if(!nN(t))throw TypeError(nL(e,t,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===t.type)throw TypeError("".concat(nB(t),' instances for asymmetric algorithms must not be of type "secret"'));if("public"===t.type)switch(n){case"sign":throw TypeError("".concat(nB(t),' instances for asymmetric algorithm signing must be of type "private"'));case"decrypt":throw TypeError("".concat(nB(t),' instances for asymmetric algorithm decryption must be of type "private"'))}if("private"===t.type)switch(n){case"verify":throw TypeError("".concat(nB(t),' instances for asymmetric algorithm verifying must be of type "public"'));case"encrypt":throw TypeError("".concat(nB(t),' instances for asymmetric algorithm encryption must be of type "public"'))}})(e,t,n)}}(l,t,"verify");let h=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=new Uint8Array(t.reduce((e,t)=>{let{length:n}=t;return e+n},0)),o=0;for(let e of t)r.set(e,o),o+=e.length;return r}(void 0!==e.protected?nw(e.protected):new Uint8Array,nw("."),"string"==typeof e.payload?c?nw(e.payload):nf.encode(e.payload):e.payload);try{r=nb(e.signature)}catch(e){throw new nA("Failed to base64url decode the signature")}let p=await nq(t,l);if(!await rm(l,p,r,h))throw new nx;if(c)try{o=nb(e.payload)}catch(e){throw new nA("Failed to base64url decode the payload")}else o="string"==typeof e.payload?nf.encode(e.payload):e.payload;let m={payload:o};return void 0!==e.protected&&(m.protectedHeader=i),void 0!==e.header&&(m.unprotectedHeader=e.header),d?e2(e2({},m),{},{key:p}):m}let ry=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function rw(e){let t,n=ry.exec(e);if(!n||n[4]&&n[1])throw TypeError("Invalid time period format");let r=parseFloat(n[2]);switch(n[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*r);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*r);break;case"day":case"days":case"d":t=Math.round(86400*r);break;case"week":case"weeks":case"w":t=Math.round(604800*r);break;default:t=Math.round(0x1e187e0*r)}return"-"===n[1]||"ago"===n[4]?-t:t}let rg=e=>e.includes("/")?e.toLowerCase():"application/".concat(e.toLowerCase());async function rb(e,t,n){var r;let o=await async function(e,t,n){if(e instanceof Uint8Array&&(e=ny.decode(e)),"string"!=typeof e)throw new nA("Compact JWS must be a string or Uint8Array");let{0:r,1:o,2:i,length:a}=e.split(".");if(3!==a)throw new nA("Invalid Compact JWS");let s=await rf({payload:o,protected:r,signature:i},t,n),c={payload:s.payload,protectedHeader:s.protectedHeader};return"function"==typeof t?e2(e2({},c),{},{key:s.key}):c}(e,t,n);if(null!=(r=o.protectedHeader.crit)&&r.includes("b64")&&!1===o.protectedHeader.b64)throw new nT("JWTs MUST NOT use unencoded payload");let i={payload:function(e,t){let n,r,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{i=JSON.parse(ny.decode(t))}catch(e){}if(!nW(i))throw new nT("JWT Claims Set must be a top-level JSON object");let{typ:s}=a;if(s&&("string"!=typeof e.typ||rg(e.typ)!==rg(s)))throw new n_('unexpected "typ" JWT header value',i,"typ","check_failed");let{requiredClaims:c=[],issuer:l,subject:u,audience:d,maxTokenAge:h}=a,p=[...c];for(let e of(void 0!==h&&p.push("iat"),void 0!==d&&p.push("aud"),void 0!==u&&p.push("sub"),void 0!==l&&p.push("iss"),new Set(p.reverse())))if(!(e in i))throw new n_('missing required "'.concat(e,'" claim'),i,e,"missing");if(l&&!(Array.isArray(l)?l:[l]).includes(i.iss))throw new n_('unexpected "iss" claim value',i,"iss","check_failed");if(u&&i.sub!==u)throw new n_('unexpected "sub" claim value',i,"sub","check_failed");if(d&&(n=i.aud,r="string"==typeof d?[d]:d,"string"==typeof n?!r.includes(n):!(Array.isArray(n)&&r.some(Set.prototype.has.bind(new Set(n))))))throw new n_('unexpected "aud" claim value',i,"aud","check_failed");switch(typeof a.clockTolerance){case"string":o=rw(a.clockTolerance);break;case"number":o=a.clockTolerance;break;case"undefined":o=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:m}=a,f=Math.floor((m||new Date).getTime()/1e3);if((void 0!==i.iat||h)&&"number"!=typeof i.iat)throw new n_('"iat" claim must be a number',i,"iat","invalid");if(void 0!==i.nbf){if("number"!=typeof i.nbf)throw new n_('"nbf" claim must be a number',i,"nbf","invalid");if(i.nbf>f+o)throw new n_('"nbf" claim timestamp check failed',i,"nbf","check_failed")}if(void 0!==i.exp){if("number"!=typeof i.exp)throw new n_('"exp" claim must be a number',i,"exp","invalid");if(i.exp<=f-o)throw new nk('"exp" claim timestamp check failed',i,"exp","check_failed")}if(h){let e=f-i.iat;if(e-o>("number"==typeof h?h:rw(h)))throw new nk('"iat" claim timestamp check failed (too far in the past)',i,"iat","check_failed");if(e<0-o)throw new n_('"iat" claim timestamp check failed (it should be in the past)',i,"iat","check_failed")}return i}(o.protectedHeader,o.payload,n),protectedHeader:o.protectedHeader};return"function"==typeof t?e2(e2({},i),{},{key:o.key}):i}function rv(e){return nW(e)}var r_,rk,rS,rE,rA,rT,rP,rR,rI=new WeakMap,rO=new WeakMap;class rx{constructor(e){if(eQ(this,rI,void 0),eQ(this,rO,new WeakMap),!(e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(rv)))throw new nP("JSON Web Key Set malformed");e$(rI,this,structuredClone(e))}jwks(){return eY(rI,this)}async getKey(e,t){let{alg:n,kid:r}=e2(e2({},e),null==t?void 0:t.header),o=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new nE('Unsupported "alg" value for a JSON Web Key Set')}}(n),i=eY(rI,this).keys.filter(e=>{let t=o===e.kty;if(t&&"string"==typeof r&&(t=r===e.kid),t&&("string"==typeof e.alg||"AKP"===o)&&(t=n===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(n){case"ES256":t="P-256"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":case"EdDSA":t="Ed25519"===e.crv}return t}),{0:a,length:s}=i;if(0===s)throw new nR;if(1!==s){var c;let e=new nI,t=eY(rO,this);throw e[Symbol.asyncIterator]=(c=function*(){for(let r of i)try{var e;yield yield(e=rC(t,r,n),new eq(e,0))}catch(e){}},function(){return new e3(c.apply(this,arguments))}),e}return rC(eY(rO,this),a,n)}}async function rC(e,t,n){let r=e.get(t)||e.set(t,{}).get(t);if(void 0===r[n]){let e=await async function(e,t){let n;if(!nW(e))throw TypeError("JWK must be an object");switch(null!=t||(t=e.alg),null!=n||(n=e.ext),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return nb(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new nE('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return nG(e2(e2({},e),{},{alg:t,ext:n}));case"AKP":if("string"!=typeof e.alg||!e.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==t&&t!==e.alg)throw TypeError("JWK alg and alg option value mismatch");return nG(e2(e2({},e),{},{ext:n}));case"EC":case"OKP":return nG(e2(e2({},e),{},{alg:t,ext:n}));default:throw new nE('Unsupported "kty" (Key Type) Parameter value')}}(e2(e2({},t),{},{ext:!0}),n);if(e instanceof Uint8Array||"public"!==e.type)throw new nP("JSON Web Key Set members must be public keys");r[n]=e}return r[n]}function rj(e){let t=new rx(e),n=async(e,n)=>t.getKey(e,n);return Object.defineProperties(n,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),n}("u"<typeof navigator||null==(rP=navigator.userAgent)||null==(rR=rP.startsWith)||!rR.call(rP,"Mozilla/5.0 "))&&(c="".concat("jose","/").concat("v6.1.3"));let rD=Symbol(),rL=Symbol();var rK=new WeakMap,rU=new WeakMap,rN=new WeakMap,rW=new WeakMap,rH=new WeakMap,rz=new WeakMap,rJ=new WeakMap,rM=new WeakMap,rV=new WeakMap,rG=new WeakMap;class rF{constructor(e,t){var n,r;if(eQ(this,rK,void 0),eQ(this,rU,void 0),eQ(this,rN,void 0),eQ(this,rW,void 0),eQ(this,rH,void 0),eQ(this,rz,void 0),eQ(this,rJ,void 0),eQ(this,rM,void 0),eQ(this,rV,void 0),eQ(this,rG,void 0),!(e instanceof URL))throw TypeError("url must be an instance of URL");e$(rK,this,new URL(e.href)),e$(rU,this,"number"==typeof(null==t?void 0:t.timeoutDuration)?null==t?void 0:t.timeoutDuration:5e3),e$(rN,this,"number"==typeof(null==t?void 0:t.cooldownDuration)?null==t?void 0:t.cooldownDuration:3e4),e$(rW,this,"number"==typeof(null==t?void 0:t.cacheMaxAge)?null==t?void 0:t.cacheMaxAge:6e5),e$(rJ,this,new Headers(null==t?void 0:t.headers)),c&&!eY(rJ,this).has("User-Agent")&&eY(rJ,this).set("User-Agent",c),eY(rJ,this).has("accept")||(eY(rJ,this).set("accept","application/json"),eY(rJ,this).append("accept","application/jwk-set+json")),e$(rM,this,null==t?void 0:t[rD]),void 0!==(null==t?void 0:t[rL])&&(e$(rG,this,null==t?void 0:t[rL]),n=null==t?void 0:t[rL],r=eY(rW,this),"object"==typeof n&&null!==n&&"uat"in n&&"number"==typeof n.uat&&!(Date.now()-n.uat>=r)&&"jwks"in n&&nW(n.jwks)&&Array.isArray(n.jwks.keys)&&Array.prototype.every.call(n.jwks.keys,nW)&&(e$(rH,this,eY(rG,this).uat),e$(rV,this,rj(eY(rG,this).jwks))))}pendingFetch(){return!!eY(rz,this)}coolingDown(){return"number"==typeof eY(rH,this)&&Date.now()<eY(rH,this)+eY(rN,this)}fresh(){return"number"==typeof eY(rH,this)&&Date.now()<eY(rH,this)+eY(rW,this)}jwks(){var e;return null==(e=eY(rV,this))?void 0:e.jwks()}async getKey(e,t){eY(rV,this)&&this.fresh()||await this.reload();try{return await eY(rV,this).call(this,e,t)}catch(n){if(n instanceof nR&&!1===this.coolingDown())return await this.reload(),eY(rV,this).call(this,e,t);throw n}}async reload(){eY(rz,this)&&("u">typeof WebSocketPair||"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"u">typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&e$(rz,this,void 0),eY(rz,this)||e$(rz,this,(async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fetch,o=await r(e,{method:"GET",signal:n,redirect:"manual",headers:t}).catch(e=>{if("TimeoutError"===e.name)throw new nO;throw e});if(200!==o.status)throw new nv("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await o.json()}catch(e){throw new nv("Failed to parse the JSON Web Key Set HTTP response as JSON")}})(eY(rK,this).href,eY(rJ,this),AbortSignal.timeout(eY(rU,this)),eY(rM,this)).then(e=>{e$(rV,this,rj(e)),eY(rG,this)&&(eY(rG,this).uat=Date.now(),eY(rG,this).jwks=e),e$(rH,this,Date.now()),e$(rz,this,void 0)}).catch(e=>{throw e$(rz,this,void 0),e})),await eY(rz,this)}}let rZ=["mfaToken"],rq=["mfaToken"];var rB,rX,rY,rQ,r$,r0,r1,r2,r5=class extends Error{constructor(e,t){super(t),e0(this,"code",void 0),this.name="NotSupportedError",this.code=e}},r3=class extends Error{constructor(e,t,n){super(t),e0(this,"cause",void 0),e0(this,"code",void 0),this.code=e,this.cause=n&&{error:n.error,error_description:n.error_description,message:n.message}}},r6=class extends r3{constructor(e,t){super("token_by_code_error",e,t),this.name="TokenByCodeError"}},r9=class extends r3{constructor(e,t){super("token_by_client_credentials_error",e,t),this.name="TokenByClientCredentialsError"}},r4=class extends r3{constructor(e,t){super("token_by_refresh_token_error",e,t),this.name="TokenByRefreshTokenError"}},r8=class extends r3{constructor(e,t){super("token_for_connection_error",e,t),this.name="TokenForConnectionErrorCode"}},r7=class extends r3{constructor(e,t){super("token_exchange_error",e,t),this.name="TokenExchangeError"}},oe=class extends Error{constructor(e){super(e),e0(this,"code","verify_logout_token_error"),this.name="VerifyLogoutTokenError"}},ot=class extends r3{constructor(e){super("backchannel_authentication_error","There was an error when trying to use Client-Initiated Backchannel Authentication.",e),e0(this,"code","backchannel_authentication_error"),this.name="BackchannelAuthenticationError"}},on=class extends r3{constructor(e){super("build_authorization_url_error","There was an error when trying to build the authorization URL.",e),this.name="BuildAuthorizationUrlError"}},or=class extends r3{constructor(e){super("build_link_user_url_error","There was an error when trying to build the Link User URL.",e),this.name="BuildLinkUserUrlError"}},oo=class extends r3{constructor(e){super("build_unlink_user_url_error","There was an error when trying to build the Unlink User URL.",e),this.name="BuildUnlinkUserUrlError"}},oi=class extends Error{constructor(){super("The client secret or client assertion signing key must be provided."),e0(this,"code","missing_client_auth_error"),this.name="MissingClientAuthError"}};function oa(e){return Object.entries(e).filter(e=>{let[,t]=e;return void 0!==t}).reduce((e,t)=>e2(e2({},e),{},{[t[0]]:t[1]}),{})}var os=class extends Error{constructor(e,t,n){super(t),e0(this,"cause",void 0),e0(this,"code",void 0),this.code=e,this.cause=n&&{error:n.error,error_description:n.error_description,message:n.message}}},oc=class extends os{constructor(e,t){super("mfa_list_authenticators_error",e,t),this.name="MfaListAuthenticatorsError"}},ol=class extends os{constructor(e,t){super("mfa_enrollment_error",e,t),this.name="MfaEnrollmentError"}},ou=class extends os{constructor(e,t){super("mfa_delete_authenticator_error",e,t),this.name="MfaDeleteAuthenticatorError"}},od=class extends os{constructor(e,t){super("mfa_challenge_error",e,t),this.name="MfaChallengeError"}};function oh(e){return{id:e.id,authenticatorType:e.authenticator_type,active:e.active,name:e.name,oobChannels:e.oob_channels,type:e.type}}var op=(rB=new WeakMap,rX=new WeakMap,rY=new WeakMap,class{constructor(e){var t;eQ(this,rB,void 0),eQ(this,rX,void 0),eQ(this,rY,void 0),e$(rB,this,"https://".concat(e.domain)),e$(rX,this,e.clientId),e$(rY,this,null!=(t=e.customFetch)?t:function(){return fetch(...arguments)})}async listAuthenticators(e){let t="".concat(eY(rB,this),"/mfa/authenticators"),{mfaToken:n}=e,r=await eY(rY,this).call(this,t,{method:"GET",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!r.ok){let e=await r.json();throw new oc(e.error_description||"Failed to list authenticators",e)}return(await r.json()).map(oh)}async enrollAuthenticator(e){let t="".concat(eY(rB,this),"/mfa/associate"),{mfaToken:n}=e,r=e5(e,rZ),o={authenticator_types:r.authenticatorTypes};"oobChannels"in r&&(o.oob_channels=r.oobChannels),"phoneNumber"in r&&r.phoneNumber&&(o.phone_number=r.phoneNumber),"email"in r&&r.email&&(o.email=r.email);let i=await eY(rY,this).call(this,t,{method:"POST",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok){let e=await i.json();throw new ol(e.error_description||"Failed to enroll authenticator",e)}var a=await i.json();if("otp"===a.authenticator_type)return{authenticatorType:"otp",secret:a.secret,barcodeUri:a.barcode_uri,recoveryCodes:a.recovery_codes,id:a.id};if("oob"===a.authenticator_type)return{authenticatorType:"oob",oobChannel:a.oob_channel,oobCode:a.oob_code,bindingMethod:a.binding_method,id:a.id};throw Error("Unexpected authenticator type: ".concat(a.authenticator_type))}async deleteAuthenticator(e){let{authenticatorId:t,mfaToken:n}=e,r="".concat(eY(rB,this),"/mfa/authenticators/").concat(encodeURIComponent(t)),o=await eY(rY,this).call(this,r,{method:"DELETE",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!o.ok){let e=await o.json();throw new ou(e.error_description||"Failed to delete authenticator",e)}}async challengeAuthenticator(e){var t;let n,r="".concat(eY(rB,this),"/mfa/challenge"),{mfaToken:o}=e,i=e5(e,rq),a={mfa_token:o,client_id:eY(rX,this),challenge_type:i.challengeType};i.authenticatorId&&(a.authenticator_id=i.authenticatorId);let s=await eY(rY,this).call(this,r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){let e=await s.json();throw new od(e.error_description||"Failed to challenge authenticator",e)}return n={challengeType:(t=await s.json()).challenge_type},void 0!==t.oob_code&&(n.oobCode=t.oob_code),void 0!==t.binding_method&&(n.bindingMethod=t.binding_method),n}}),om=class e{constructor(e,t,n,r,o,i,a){e0(this,"accessToken",void 0),e0(this,"idToken",void 0),e0(this,"refreshToken",void 0),e0(this,"expiresAt",void 0),e0(this,"scope",void 0),e0(this,"claims",void 0),e0(this,"authorizationDetails",void 0),e0(this,"tokenType",void 0),e0(this,"issuedTokenType",void 0),this.accessToken=e,this.idToken=n,this.refreshToken=r,this.expiresAt=t,this.scope=o,this.claims=i,this.authorizationDetails=a}static fromTokenEndpointResponse(t){let n=t.id_token?t.claims():void 0,r=new e(t.access_token,Math.floor(Date.now()/1e3)+Number(t.expires_in),t.id_token,t.refresh_token,t.scope,n,t.authorization_details);return r.tokenType=t.token_type,r.issuedTokenType=t.issued_token_type,r}},of="openid profile email offline_access",oy=Object.freeze(new Set(["grant_type","client_id","client_secret","client_assertion","client_assertion_type","subject_token","subject_token_type","requested_token_type","actor_token","actor_token_type","audience","aud","resource","resources","resource_indicator","scope","connection","login_hint","organization","assertion"]));function ow(e){if(null==e)throw new r7("subject_token is required");if("string"!=typeof e)throw new r7("subject_token must be a string");if(0===e.trim().length)throw new r7("subject_token cannot be blank or whitespace");if(e!==e.trim())throw new r7("subject_token must not include leading or trailing whitespace");if(/^bearer\s+/i.test(e))throw new r7("subject_token must not include the 'Bearer ' prefix")}function og(e,t){if(t){for(let[n,r]of Object.entries(t))if(!oy.has(n))if(Array.isArray(r)){if(r.length>20)throw new r7("Parameter '".concat(n,"' exceeds maximum array size of ").concat(20));r.forEach(t=>{e.append(n,t)})}else e.append(n,r)}}var ob=(rQ=new WeakMap,r$=new WeakMap,r0=new WeakMap,r1=new WeakMap,r2=new WeakSet,class{constructor(e){if(eX(this,r2),r2.add(this),eQ(this,rQ,void 0),eQ(this,r$,void 0),eQ(this,r0,void 0),eQ(this,r1,void 0),e0(this,"mfa",void 0),e$(r0,this,e),e.useMtls&&!e.customFetch)throw new r5("mtls_without_custom_fetch_not_supported","Using mTLS without a custom fetch implementation is not supported");this.mfa=new op({domain:eY(r0,this).domain,clientId:eY(r0,this).clientId,customFetch:eY(r0,this).customFetch})}async buildAuthorizationUrl(e){let{serverMetadata:t}=await eB(r2,this,ov).call(this);if(null!=e&&e.pushedAuthorizationRequests&&!t.pushed_authorization_request_endpoint)throw new r5("par_not_supported_error","The Auth0 tenant does not have pushed authorization requests enabled. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-par");try{return await eB(r2,this,oE).call(this,e)}catch(e){throw new on(e)}}async buildLinkUserUrl(e){try{let t=await eB(r2,this,oE).call(this,{authorizationParams:e2(e2({},e.authorizationParams),{},{requested_connection:e.connection,requested_connection_scope:e.connectionScope,scope:"openid link_account offline_access",id_token_hint:e.idToken})});return{linkUserUrl:t.authorizationUrl,codeVerifier:t.codeVerifier}}catch(e){throw new or(e)}}async buildUnlinkUserUrl(e){try{let t=await eB(r2,this,oE).call(this,{authorizationParams:e2(e2({},e.authorizationParams),{},{requested_connection:e.connection,scope:"openid unlink_account",id_token_hint:e.idToken})});return{unlinkUserUrl:t.authorizationUrl,codeVerifier:t.codeVerifier}}catch(e){throw new oo(e)}}async backchannelAuthentication(e){let{configuration:t,serverMetadata:n}=await eB(r2,this,ov).call(this),r=oa(e2(e2({},eY(r0,this).authorizationParams),null==e?void 0:e.authorizationParams)),o=new URLSearchParams(e2(e2({scope:of},r),{},{client_id:eY(r0,this).clientId,binding_message:e.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:n.issuer,sub:e.loginHint.sub})}));e.requestedExpiry&&o.append("requested_expiry",e.requestedExpiry.toString()),e.authorizationDetails&&o.append("authorization_details",JSON.stringify(e.authorizationDetails));try{let e=await re(t,o),n=await rt(t,e);return om.fromTokenEndpointResponse(n)}catch(e){throw new ot(e)}}async initiateBackchannelAuthentication(e){let{configuration:t,serverMetadata:n}=await eB(r2,this,ov).call(this),r=oa(e2(e2({},eY(r0,this).authorizationParams),null==e?void 0:e.authorizationParams)),o=new URLSearchParams(e2(e2({scope:of},r),{},{client_id:eY(r0,this).clientId,binding_message:e.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:n.issuer,sub:e.loginHint.sub})}));e.requestedExpiry&&o.append("requested_expiry",e.requestedExpiry.toString()),e.authorizationDetails&&o.append("authorization_details",JSON.stringify(e.authorizationDetails));try{let e=await re(t,o);return{authReqId:e.auth_req_id,expiresIn:e.expires_in,interval:e.interval}}catch(e){throw new ot(e)}}async backchannelAuthenticationGrant(e){let{authReqId:t}=e,{configuration:n}=await eB(r2,this,ov).call(this),r=new URLSearchParams({auth_req_id:t});try{let e=await rh(n,"urn:openid:params:grant-type:ciba",r);return om.fromTokenEndpointResponse(e)}catch(e){throw new ot(e)}}async getTokenForConnection(e){var t;if(e.refreshToken&&e.accessToken)throw new r8("Either a refresh or access token should be specified, but not both.");let n=null!=(t=e.accessToken)?t:e.refreshToken;if(!n)throw new r8("Either a refresh or access token must be specified.");try{return await this.exchangeToken({connection:e.connection,subjectToken:n,subjectTokenType:e.accessToken?"urn:ietf:params:oauth:token-type:access_token":"urn:ietf:params:oauth:token-type:refresh_token",loginHint:e.loginHint})}catch(e){if(e instanceof r7)throw new r8(e.message,e.cause);throw e}}async exchangeToken(e){return"connection"in e?eB(r2,this,o_).call(this,e):eB(r2,this,ok).call(this,e)}async getTokenByCode(e,t){let{configuration:n}=await eB(r2,this,ov).call(this);try{let r=await rr(n,e,{pkceCodeVerifier:t.codeVerifier});return om.fromTokenEndpointResponse(r)}catch(e){throw new r6("There was an error while trying to request a token.",e)}}async getTokenByRefreshToken(e){let{configuration:t}=await eB(r2,this,ov).call(this);try{let n=await ro(t,e.refreshToken);return om.fromTokenEndpointResponse(n)}catch(e){throw new r4("The access token has expired and there was an error while trying to refresh it.",e)}}async getTokenByClientCredentials(e){let{configuration:t}=await eB(r2,this,ov).call(this);try{let n=new URLSearchParams({audience:e.audience});e.organization&&n.append("organization",e.organization);let r=await ri(t,n);return om.fromTokenEndpointResponse(r)}catch(e){throw new r9("There was an error while trying to request a token.",e)}}async buildLogoutUrl(e){let{configuration:t,serverMetadata:n}=await eB(r2,this,ov).call(this);if(!n.end_session_endpoint){let t=new URL("https://".concat(eY(r0,this).domain,"/v2/logout"));return t.searchParams.set("returnTo",e.returnTo),t.searchParams.set("client_id",eY(r0,this).clientId),t}return function(e,t){rc(e);let{as:n,c:r,tlsOnly:o}=a.get(e),i=tR(n,"end_session_endpoint",!1,o);for(let[e,n]of((t=new URLSearchParams(t)).has("client_id")||t.set("client_id",r.client_id),t.entries()))i.searchParams.append(e,n);return i}(t,{post_logout_redirect_uri:e.returnTo})}async verifyLogoutToken(e){let t,n,{serverMetadata:r}=await eB(r2,this,ov).call(this);eY(r1,this)||e$(r1,this,(t=new rF(new URL(r.jwks_uri),{[rD]:eY(r0,this).customFetch}),Object.defineProperties(n=async(e,n)=>t.getKey(e,n),{coolingDown:{get:()=>t.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>t.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>t.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>t.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>t.jwks(),enumerable:!0,configurable:!1,writable:!1}}),n));let{payload:o}=await rb(e.logoutToken,eY(r1,this),{issuer:r.issuer,audience:eY(r0,this).clientId,algorithms:["RS256"],requiredClaims:["iat"]});if(!("sid"in o)&&!("sub"in o))throw new oe('either "sid" or "sub" (or both) claims must be present');if("sid"in o&&"string"!=typeof o.sid)throw new oe('"sid" claim must be a string');if("sub"in o&&"string"!=typeof o.sub)throw new oe('"sub" claim must be a string');if("nonce"in o)throw new oe('"nonce" claim is prohibited');if(!("events"in o))throw new oe('"events" claim is missing');if("object"!=typeof o.events||null===o.events)throw new oe('"events" claim must be an object');if(!("http://schemas.openid.net/event/backchannel-logout"in o.events))throw new oe('"http://schemas.openid.net/event/backchannel-logout" member is missing in the "events" claim');if("object"!=typeof o.events["http://schemas.openid.net/event/backchannel-logout"])throw new oe('"http://schemas.openid.net/event/backchannel-logout" member in the "events" claim must be an object');return{sid:o.sid,sub:o.sub}}});async function ov(){if(eY(rQ,this)&&eY(r$,this))return{configuration:eY(rQ,this),serverMetadata:eY(r$,this)};let e=await eB(r2,this,oS).call(this);return e$(rQ,this,await n3(new URL("https://".concat(eY(r0,this).domain)),eY(r0,this).clientId,{use_mtls_endpoint_aliases:eY(r0,this).useMtls},e,{[te]:eY(r0,this).customFetch})),e$(r$,this,eY(rQ,this).serverMetadata()),eY(rQ,this)[te]=eY(r0,this).customFetch||fetch,{configuration:eY(rQ,this),serverMetadata:eY(r$,this)}}async function o_(e){var t,n;let{configuration:r}=await eB(r2,this,ov).call(this);if("audience"in e||"resource"in e)throw new r7("audience and resource parameters are not supported for Token Vault exchanges");ow(e.subjectToken);let o=new URLSearchParams({connection:e.connection,subject_token:e.subjectToken,subject_token_type:null!=(t=e.subjectTokenType)?t:"urn:ietf:params:oauth:token-type:access_token",requested_token_type:null!=(n=e.requestedTokenType)?n:"http://auth0.com/oauth/token-type/federated-connection-access-token"});e.loginHint&&o.append("login_hint",e.loginHint),e.scope&&o.append("scope",e.scope),og(o,e.extra);try{let e=await rh(r,"urn:auth0:params:oauth:grant-type:token-exchange:federated-connection-access-token",o);return om.fromTokenEndpointResponse(e)}catch(t){throw new r7("Failed to exchange token for connection '".concat(e.connection,"'."),t)}}async function ok(e){let{configuration:t}=await eB(r2,this,ov).call(this);ow(e.subjectToken);let n=new URLSearchParams({subject_token_type:e.subjectTokenType,subject_token:e.subjectToken});e.audience&&n.append("audience",e.audience),e.scope&&n.append("scope",e.scope),e.requestedTokenType&&n.append("requested_token_type",e.requestedTokenType),e.organization&&n.append("organization",e.organization),og(n,e.extra);try{let e=await rh(t,"urn:ietf:params:oauth:grant-type:token-exchange",n);return om.fromTokenEndpointResponse(e)}catch(t){throw new r7("Failed to exchange token of type '".concat(e.subjectTokenType,"'").concat(e.audience?" for audience '".concat(e.audience,"'"):"","."),t)}}async function oS(){if(!eY(r0,this).clientSecret&&!eY(r0,this).clientAssertionSigningKey&&!eY(r0,this).useMtls)throw new oi;if(eY(r0,this).useMtls)return(e,t,n,r)=>{n.set("client_id",t.client_id)};let e=eY(r0,this).clientAssertionSigningKey;return!e||e instanceof CryptoKey||(e=await async function(e,t){var n,r;let o,i,a;if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return n=void 0,o=/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,i=ng(e.replace(o,"")),a=n,null!=t&&null!=(r=t.startsWith)&&r.call(t,"ECDH-ES")&&(a||(a={}),a.getNamedCurve=e=>{let t,n={data:e,pos:0};return nJ(n,48,"Invalid PKCS#8 structure"),nz(n),nJ(n,2,"Expected version field"),t=nz(n),n.pos+=t,nJ(n,48,"Expected algorithm identifier"),nz(n),n.pos,(e=>{let t,n=(nJ(e,6,"Expected algorithm OID"),t=nz(e),nM(e,t));if(nH(n,[43,101,110]))return"X25519";if(!nH(n,[42,134,72,206,61,2,1]))throw Error("Unsupported key algorithm");nJ(e,6,"Expected curve OID");let r=nz(e),o=nM(e,r);for(let{name:e,oid:t}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(nH(o,t))return e;throw Error("Unsupported named curve")})(n)}),nV("pkcs8",i,t,a)}(e,eY(r0,this).clientAssertionSigningAlg||"RS256")),e?function(e,t){let{key:n,kid:r}=e instanceof CryptoKey?{key:e}:(null==e?void 0:e.key)instanceof CryptoKey?(void 0!==e.kid&&ty(e.kid,'"kid"'),{key:e.key,kid:e.kid}):{};return function(e,t){if(function(e,t){if(!(e instanceof CryptoKey))throw e9("".concat(t," must be a CryptoKey"),"ERR_INVALID_ARG_TYPE")}(e,t),"private"!==e.type)throw e9("".concat(t," must be a private CryptoKey"),"ERR_INVALID_ARG_VALUE")}(n,'"clientPrivateKey.key"'),async(e,o,i,a)=>{var s;let c,l={alg:function(e){switch(e.algorithm.name){case"RSA-PSS":switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new ts("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}case"RSASSA-PKCS1-v1_5":switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new ts("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}case"ECDSA":switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new ts("unsupported EcKeyAlgorithm namedCurve",{cause:e})}case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return e.algorithm.name;case"EdDSA":return"Ed25519";default:throw new ts("unsupported CryptoKey algorithm name",{cause:e})}}(n),kid:r},u=(c=t_()+tb(o),{jti:tg(),aud:e.issuer,exp:c+60,iat:c,nbf:c,iss:o.client_id,sub:o.client_id});null==t||null==(s=t[tt])||s.call(t,l,u),i.set("client_id",o.client_id),i.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),i.set("client_assertion",await async function(e,t,n){if(!n.usages.includes("sign"))throw e9('CryptoKey instances used for signing assertions must include "sign" in their "usages"',"ERR_INVALID_ARG_VALUE");let r="".concat(ta(ti(JSON.stringify(e))),".").concat(ta(ti(JSON.stringify(t)))),o=ta(await crypto.subtle.sign(function(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:function(e){let{algorithm:t}=e;switch(t.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new ts("unsupported ECDSA namedCurve",{cause:e})}}(e)};case"RSA-PSS":switch(na(e),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new ts("unsupported RSA-PSS hash name",{cause:e})}case"RSASSA-PKCS1-v1_5":return na(e),e.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return e.algorithm.name}throw new ts("unsupported CryptoKey algorithm name",{cause:e})}(n),n,ti(r)));return"".concat(r,".").concat(o)}(l,u,n))}}(e,void 0):nY(eY(r0,this).clientSecret)}async function oE(e){let{configuration:t}=await eB(r2,this,ov).call(this),n=tg(),r=await async function(e){return ty(e,"codeVerifier"),ta(await crypto.subtle.digest("SHA-256",ti(e)))}(n),o=oa(e2(e2({},eY(r0,this).authorizationParams),null==e?void 0:e.authorizationParams)),i=new URLSearchParams(e2(e2({scope:of},o),{},{client_id:eY(r0,this).clientId,code_challenge:r,code_challenge_method:"S256"}));return{authorizationUrl:null!=e&&e.pushedAuthorizationRequests?await rs(t,i):await ra(t,i),codeVerifier:n}}let oA=new O;class oT{constructor(e){var t,n;let r,o,i,a,s;if(this.userCache=(new ev).enclosedCache,this.activeLockKeys=new Set,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=async()=>{for(let e of Array.from(this.activeLockKeys))await oA.releaseLock(e);this.activeLockKeys.clear(),window.removeEventListener("pagehide",this._releaseLockOnPageHide)},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),e.authorizationParams)}),"u">typeof window&&(()=>{if(!window.crypto)throw Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(void 0===window.crypto.subtle)throw Error("\n      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.\n    ")})(),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)o=e.cache;else{if(!eW(r=e.cacheLocation||"memory"))throw Error('Invalid cache location "'.concat(r,'"'));o=eW(r)()}this.httpTimeoutMs=e.httpTimeoutInSeconds?1e3*e.httpTimeoutInSeconds:1e4,this.cookieStorage=!1===e.legacySameSiteCookie?eR:eI,this.orgHintCookieName=(t=this.options.clientId,"auth0.".concat(t,".organization_hint")),this.isAuthenticatedCookieName=(i=this.options.clientId,"auth0.".concat(i,".is.authenticated")),this.sessionCheckExpiryDays=e.sessionCheckExpiryDays||1;let c=e.useCookiesForTransactions?this.cookieStorage:eO;this.scope=function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];if("object"!=typeof e)return{default:ey(t,e,...r)};let i={default:ey(t,...r)};return Object.keys(e).forEach(n=>{let o=e[n];i[n]=ey(t,o,...r)}),i}(this.options.authorizationParams.scope,"openid",this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new ek(c,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||j,this.cacheManager=new e_(o,o.allKeys?void 0:new eU(o,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new eV(this.options.clientId):void 0,this.domainUrl=(n=this.options.domain,/^https?:\/\//.test(n)?n:"https://".concat(n)),this.tokenIssuer=(a=this.options.issuer,s=this.domainUrl,a?a.startsWith("https://")?a:"https://".concat(a,"/"):"".concat(s,"/"));let l="".concat(this.domainUrl,"/me/"),u=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:l},detailedResponse:!0})}));this.myAccountApi=new eF(u,l),this.authJsClient=new ob({domain:this.options.domain,clientId:this.options.clientId}),"u">typeof window&&window.Worker&&this.options.useRefreshTokens&&"memory"===r&&(this.options.workerUrl?this.worker=new Worker(this.options.workerUrl):this.worker=new eD)}getConfiguration(){return Object.freeze({domain:this.options.domain,clientId:this.options.clientId})}_url(e){let t=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||C)));return"".concat(this.domainUrl).concat(e,"&auth0Client=").concat(t)}_authorizeUrl(e){return this._url("/authorize?".concat(q(e)))}async _verifyIdToken(e,t,n){var r;let o=await this.nowProvider();return(e=>{if(!e.id_token)throw Error("ID token is required but missing");let t=(e=>{let t=e.split("."),[n,r,o]=t;if(3!==t.length||!n||!r||!o)throw Error("ID token could not be decoded");let i=JSON.parse(X(r)),a={__raw:e},s={};return Object.keys(i).forEach(e=>{a[e]=i[e],eS.includes(e)||(s[e]=i[e])}),{encoded:{header:n,payload:r,signature:o},header:JSON.parse(X(n)),claims:a,user:s}})(e.id_token);if(!t.claims.iss)throw Error("Issuer (iss) claim must be a string present in the ID token");if(t.claims.iss!==e.iss)throw Error('Issuer (iss) claim mismatch in the ID token; expected "'.concat(e.iss,'", found "').concat(t.claims.iss,'"'));if(!t.user.sub)throw Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==t.header.alg)throw Error('Signature algorithm of "'.concat(t.header.alg,'" is not supported. Expected the ID token to be signed with "RS256".'));if(!t.claims.aud||"string"!=typeof t.claims.aud&&!Array.isArray(t.claims.aud))throw Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e.aud))throw Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(e.aud,'" but was not one of "').concat(t.claims.aud.join(", "),'"'));if(t.claims.aud.length>1){if(!t.claims.azp)throw Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(t.claims.azp!==e.aud)throw Error('Authorized Party (azp) claim mismatch in the ID token; expected "'.concat(e.aud,'", found "').concat(t.claims.azp,'"'))}}else if(t.claims.aud!==e.aud)throw Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(e.aud,'" but found "').concat(t.claims.aud,'"'));if(e.nonce){if(!t.claims.nonce)throw Error("Nonce (nonce) claim must be a string present in the ID token");if(t.claims.nonce!==e.nonce)throw Error('Nonce (nonce) claim mismatch in the ID token; expected "'.concat(e.nonce,'", found "').concat(t.claims.nonce,'"'))}if(e.max_age&&"number"!=typeof t.claims.auth_time)throw Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(null==t.claims.exp||"number"!=typeof t.claims.exp)throw Error("Expiration Time (exp) claim must be a number present in the ID token");if("number"!=typeof t.claims.iat)throw Error("Issued At (iat) claim must be a number present in the ID token");let n=e.leeway||60,r=new Date(e.now||Date.now()),o=new Date(0);if(o.setUTCSeconds(t.claims.exp+n),r>o)throw Error("Expiration Time (exp) claim error in the ID token; current time (".concat(r,") is after expiration time (").concat(o,")"));if(null!=t.claims.nbf&&"number"==typeof t.claims.nbf){let e=new Date(0);if(e.setUTCSeconds(t.claims.nbf-n),r<e)throw Error("Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (".concat(r,") is before ").concat(e))}if(null!=t.claims.auth_time&&"number"==typeof t.claims.auth_time){let o=new Date(0);if(o.setUTCSeconds(parseInt(t.claims.auth_time)+e.max_age+n),r>o)throw Error("Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (".concat(r,") is after last auth at ").concat(o))}if(e.organization){let n=e.organization.trim();if(n.startsWith("org_")){if(!t.claims.org_id)throw Error("Organization ID (org_id) claim must be a string present in the ID token");if(n!==t.claims.org_id)throw Error('Organization ID (org_id) claim mismatch in the ID token; expected "'.concat(n,'", found "').concat(t.claims.org_id,'"'))}else{let e=n.toLowerCase();if(!t.claims.org_name)throw Error("Organization Name (org_name) claim must be a string present in the ID token");if(e!==t.claims.org_name)throw Error('Organization Name (org_name) claim mismatch in the ID token; expected "'.concat(e,'", found "').concat(t.claims.org_name,'"'))}}return t})({iss:this.tokenIssuer,aud:this.options.clientId,id_token:e,nonce:t,organization:n,leeway:this.options.leeway,max_age:"string"!=typeof(r=this.options.authorizationParams.max_age)?r:parseInt(r,10)||void 0,now:o})}_processOrgHint(e){e?this.cookieStorage.save(this.orgHintCookieName,e,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}async _prepareAuthorizeUrl(e,t,n){var r;let o,i,a,s,c=btoa(F()),l=btoa(F()),u=F(),d=Y(await B(u)),h=await (null==(r=this.dpop)?void 0:r.calculateThumbprint()),p=(o=this.options,i=this.scope,a=e.redirect_uri||this.options.authorizationParams.redirect_uri||n,s=null==t?void 0:t.response_mode,Object.assign(Object.assign(Object.assign({client_id:o.clientId},o.authorizationParams),e),{scope:ew(i,e.scope,e.audience),response_type:"code",response_mode:s||"query",state:c,nonce:l,redirect_uri:a||o.authorizationParams.redirect_uri,code_challenge:d,code_challenge_method:"S256",dpop_jkt:h})),m=this._authorizeUrl(p);return{nonce:l,code_verifier:u,scope:p.scope,audience:p.audience||"default",redirect_uri:p.redirect_uri,state:c,url:m}}async loginWithPopup(e,t){var n;let r,o,i;if(e=e||{},!(t=t||{}).popup&&(t.popup=(r=window.screenX+(window.innerWidth-400)/2,o=window.screenY+(window.innerHeight-600)/2,window.open("","auth0:authorize:popup","left=".concat(r,",top=").concat(o,",width=").concat(400,",height=").concat(600,",resizable,scrollbars=yes,status=1"))),!t.popup))throw new H;let a=await this._prepareAuthorizeUrl(e.authorizationParams||{},{response_mode:"web_message"},window.location.origin);t.popup.location.href=a.url;let s=await (i=Object.assign(Object.assign({},t),{timeoutInSeconds:t.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60}),new Promise((e,t)=>{let n,r=setInterval(()=>{i.popup&&i.popup.closed&&(clearInterval(r),clearTimeout(o),window.removeEventListener("message",n,!1),t(new W(i.popup)))},1e3),o=setTimeout(()=>{clearInterval(r),t(new N(i.popup)),window.removeEventListener("message",n,!1)},1e3*(i.timeoutInSeconds||60));n=function(a){if(a.data&&"authorization_response"===a.data.type){if(clearTimeout(o),clearInterval(r),window.removeEventListener("message",n,!1),!1!==i.closePopup&&i.popup.close(),a.data.response.error)return t(D.fromPayload(a.data.response));e(a.data.response)}},window.addEventListener("message",n)}));if(a.state!==s.state)throw new D("state_mismatch","Invalid state");let c=(null==(n=e.authorizationParams)?void 0:n.organization)||this.options.authorizationParams.organization;await this._requestToken({audience:a.audience,scope:a.scope,code_verifier:a.code_verifier,grant_type:"authorization_code",code:s.code,redirect_uri:a.redirect_uri},{nonceIn:a.nonce,organization:c})}async getUser(){var e;let t=await this._getIdTokenFromCache();return null==(e=null==t?void 0:t.decodedToken)?void 0:e.user}async getIdTokenClaims(){var e;let t=await this._getIdTokenFromCache();return null==(e=null==t?void 0:t.decodedToken)?void 0:e.claims}async loginWithRedirect(){var e;let t=eH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),{openUrl:n,fragment:r,appState:o}=t,i=v(t,["openUrl","fragment","appState"]),a=(null==(e=i.authorizationParams)?void 0:e.organization)||this.options.authorizationParams.organization,s=await this._prepareAuthorizeUrl(i.authorizationParams||{}),{url:c}=s,l=v(s,["url"]);this.transactionManager.create(Object.assign(Object.assign(Object.assign({},l),{appState:o,response_type:eC.Code}),a&&{organization:a}));let u=r?"".concat(c,"#").concat(r):c;n?await n(u):window.location.assign(u)}async handleRedirectCallback(){var e;let t,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href).split("?").slice(1);if(0===n.length)throw Error("There are no query params available for parsing.");let r=this.transactionManager.get();if(!r)throw new D("missing_transaction","Invalid state");this.transactionManager.remove();let o=((e=n.join("")).indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#"))),{state:(t=new URLSearchParams(e)).get("state"),code:t.get("code")||void 0,connect_code:t.get("connect_code")||void 0,error:t.get("error")||void 0,error_description:t.get("error_description")||void 0});return r.response_type===eC.ConnectCode?this._handleConnectAccountRedirectCallback(o,r):this._handleLoginRedirectCallback(o,r)}async _handleLoginRedirectCallback(e,t){let{code:n,state:r,error:o,error_description:i}=e;if(o)throw new L(o,i||o,r,t.appState);if(!t.code_verifier||t.state&&t.state!==r)throw new D("state_mismatch","Invalid state");let a=t.organization,s=t.nonce,c=t.redirect_uri;return await this._requestToken(Object.assign({audience:t.audience,scope:t.scope,code_verifier:t.code_verifier,grant_type:"authorization_code",code:n},c?{redirect_uri:c}:{}),{nonceIn:s,organization:a}),{appState:t.appState,response_type:eC.Code}}async _handleConnectAccountRedirectCallback(e,t){let{connect_code:n,state:r,error:o,error_description:i}=e;if(o)throw new K(o,i||o,t.connection,r,t.appState);if(!n)throw new D("missing_connect_code","Missing connect code");if(!(t.code_verifier&&t.state&&t.auth_session&&t.redirect_uri&&t.state===r))throw new D("state_mismatch","Invalid state");return Object.assign(Object.assign({},await this.myAccountApi.completeAccount({auth_session:t.auth_session,connect_code:n,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier})),{appState:t.appState,response_type:eC.ConnectCode})}async checkSession(e){if(!this.cookieStorage.get(this.isAuthenticatedCookieName)){if(!this.cookieStorage.get("auth0.is.authenticated"))return;this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove("auth0.is.authenticated")}try{await this.getTokenSilently(e)}catch(e){}}async getTokenSilently(){var e,t,n,r;let o,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign(Object.assign({cacheMode:"on"},i),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),i.authorizationParams),{scope:ew(this.scope,null==(e=i.authorizationParams)?void 0:e.scope,(null==(t=i.authorizationParams)?void 0:t.audience)||this.options.authorizationParams.audience)})}),s=await (n=()=>this._getTokenSilently(a),(o=eL[r="".concat(this.options.clientId,"::").concat(a.authorizationParams.audience,"::").concat(a.authorizationParams.scope)])||(o=n().finally(()=>{delete eL[r],o=null}),eL[r]=o),o);return i.detailedResponse?s:null==s?void 0:s.access_token}async _getTokenSilently(e){var t,n;let{cacheMode:r}=e,o=v(e,["cacheMode"]);if("off"!==r){let e=await this._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:this.options.clientId,cacheMode:r});if(e)return e}if("cache-only"===r)return;let i=(t=this.options.clientId,n=o.authorizationParams.audience||"default","".concat("auth0.lock.getTokenSilently",".").concat(t,".").concat(n));if(!await eK(()=>oA.acquireLock(i,5e3),10))throw new U;this.activeLockKeys.add(i),1===this.activeLockKeys.size&&window.addEventListener("pagehide",this._releaseLockOnPageHide);try{if("off"!==r){let e=await this._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:this.options.clientId});if(e)return e}let{id_token:e,token_type:t,access_token:n,oauthTokenScope:i,expires_in:a}=this.options.useRefreshTokens?await this._getTokenUsingRefreshToken(o):await this._getTokenFromIFrame(o);return Object.assign(Object.assign({id_token:e,token_type:t,access_token:n},i?{scope:i}:null),{expires_in:a})}finally{await oA.releaseLock(i),this.activeLockKeys.delete(i),0===this.activeLockKeys.size&&window.removeEventListener("pagehide",this._releaseLockOnPageHide)}}async getTokenWithPopup(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=Object.assign(Object.assign({},n),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),n.authorizationParams),{scope:ew(this.scope,null==(e=n.authorizationParams)?void 0:e.scope,(null==(t=n.authorizationParams)?void 0:t.audience)||this.options.authorizationParams.audience)})});return r=Object.assign(Object.assign({},x),r),await this.loginWithPopup(o,r),(await this.cacheManager.get(new eg({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt)).access_token}async isAuthenticated(){return!!await this.getUser()}_buildLogoutUrl(e){null!==e.clientId?e.clientId=e.clientId||this.options.clientId:delete e.clientId;let t=e.logoutParams||{},{federated:n}=t,r=v(t,["federated"]);return this._url("/v2/logout?".concat(q(Object.assign({clientId:e.clientId},r))))+(n?"&federated":"")}async logout(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=eH(t),{openUrl:r}=n,o=v(n,["openUrl"]);null===t.clientId?await this.cacheManager.clear():await this.cacheManager.clear(t.clientId||this.options.clientId),this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove(this.isAuthenticatedCookieName,{cookieDomain:this.options.cookieDomain}),this.userCache.remove("@@user@@"),await (null==(e=this.dpop)?void 0:e.clear());let i=this._buildLogoutUrl(o);r?await r(i):!1!==r&&window.location.assign(i)}async _getTokenFromIFrame(e){var t;let n=(t=this.options.clientId,"".concat("auth0.lock.getTokenFromIFrame",".").concat(t));if(!await eK(()=>oA.acquireLock(n,5e3),10))throw new U;try{let t,n=Object.assign(Object.assign({},e.authorizationParams),{prompt:"none"}),r=this.cookieStorage.get(this.orgHintCookieName);r&&!n.organization&&(n.organization=r);let{url:o,state:i,nonce:a,code_verifier:s,redirect_uri:c,scope:l,audience:u}=await this._prepareAuthorizeUrl(n,{response_mode:"web_message"},window.location.origin);if(window.crossOriginIsolated)throw new D("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");let d=e.timeoutInSeconds||this.options.authorizeTimeoutInSeconds;try{t=new URL(this.domainUrl).origin}catch(e){t=this.domainUrl}let h=await function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return new Promise((r,o)=>{let i,a=window.document.createElement("iframe");a.setAttribute("width","0"),a.setAttribute("height","0"),a.style.display="none";let s=()=>{window.document.body.contains(a)&&(window.document.body.removeChild(a),window.removeEventListener("message",i,!1))},c=setTimeout(()=>{o(new U),s()},1e3*n);i=function(e){if(e.origin!=t||!e.data||"authorization_response"!==e.data.type)return;let n=e.source;n&&n.close(),e.data.response.error?o(D.fromPayload(e.data.response)):r(e.data.response),clearTimeout(c),window.removeEventListener("message",i,!1),setTimeout(s,2e3)},window.addEventListener("message",i,!1),window.document.body.appendChild(a),a.setAttribute("src",e)})}(o,t,d);if(i!==h.state)throw new D("state_mismatch","Invalid state");let p=await this._requestToken(Object.assign(Object.assign({},e.authorizationParams),{code_verifier:s,code:h.code,grant_type:"authorization_code",redirect_uri:c,timeout:e.authorizationParams.timeout||this.httpTimeoutMs}),{nonceIn:a,organization:n.organization});return Object.assign(Object.assign({},p),{scope:l,oauthTokenScope:p.scope,audience:u})}catch(e){throw"login_required"===e.error&&this.logout({openUrl:!1}),e}finally{await oA.releaseLock(n)}}async _getTokenUsingRefreshToken(e){var t,n,r,o,i;let a=await this.cacheManager.get(new eg({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt);if(!(a&&a.refresh_token||this.worker)){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);throw new J(e.authorizationParams.audience||"default",e.authorizationParams.scope)}let s=e.authorizationParams.redirect_uri||this.options.authorizationParams.redirect_uri||window.location.origin,c="number"==typeof e.timeoutInSeconds?1e3*e.timeoutInSeconds:null,l=((e,t,n,r)=>{var o;if(e&&n&&r){if(t.audience!==n)return t.scope;let e=r.split(" "),i=(null==(o=t.scope)?void 0:o.split(" "))||[],a=i.every(t=>e.includes(t));return e.length>=i.length&&a?r:t.scope}return t.scope})(this.options.useMrrt,e.authorizationParams,null==a?void 0:a.audience,null==a?void 0:a.scope);try{let u=await this._requestToken(Object.assign(Object.assign(Object.assign({},e.authorizationParams),{grant_type:"refresh_token",refresh_token:a&&a.refresh_token,redirect_uri:s}),c&&{timeout:c}),{scopesToRequest:l});if(u.refresh_token&&(null==a?void 0:a.refresh_token)&&await this.cacheManager.updateEntry(a.refresh_token,u.refresh_token),this.options.useMrrt&&(t=null==a?void 0:a.audience,n=null==a?void 0:a.scope,r=e.authorizationParams.audience,o=e.authorizationParams.scope,t!==r||!ez(o,n))&&!ez(l,u.scope)){let t,n;if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);await this.cacheManager.remove(this.options.clientId,e.authorizationParams.audience,e.authorizationParams.scope);let r=(i=u.scope,t=(null==l?void 0:l.split(" "))||[],n=(null==i?void 0:i.split(" "))||[],t.filter(e=>-1==n.indexOf(e)).join(","));throw new M(e.authorizationParams.audience||"default",r)}return Object.assign(Object.assign({},u),{scope:e.authorizationParams.scope,oauthTokenScope:u.scope,audience:e.authorizationParams.audience||"default"})}catch(t){if((t.message.indexOf("Missing Refresh Token")>-1||t.message&&t.message.indexOf("invalid refresh token")>-1)&&this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);throw t}}async _saveEntryInCache(e){let{id_token:t,decodedToken:n}=e,r=v(e,["id_token","decodedToken"]);this.userCache.set("@@user@@",{id_token:t,decodedToken:n}),await this.cacheManager.setIdToken(this.options.clientId,e.id_token,e.decodedToken),await this.cacheManager.set(r)}async _getIdTokenFromCache(){let e=this.options.authorizationParams.audience||"default",t=this.scope[e],n=await this.cacheManager.getIdToken(new eg({clientId:this.options.clientId,audience:e,scope:t})),r=this.userCache.get("@@user@@");return n&&n.id_token===(null==r?void 0:r.id_token)?r:(this.userCache.set("@@user@@",n),n)}async _getEntryFromCache(e){let{scope:t,audience:n,clientId:r,cacheMode:o}=e,i=await this.cacheManager.get(new eg({scope:t,audience:n,clientId:r}),60,this.options.useMrrt,o);if(i&&i.access_token){let{token_type:e,access_token:t,oauthTokenScope:n,expires_in:r}=i,o=await this._getIdTokenFromCache();return o&&Object.assign(Object.assign({id_token:o.id_token,token_type:e||"Bearer",access_token:t},n?{scope:n}:null),{expires_in:r})}}async _requestToken(e,t){var n,r;let{nonceIn:o,organization:i,scopesToRequest:a}=t||{},s=await ef(Object.assign(Object.assign({baseUrl:this.domainUrl,client_id:this.options.clientId,auth0Client:this.options.auth0Client,useFormData:this.options.useFormData,timeout:this.httpTimeoutMs,useMrrt:this.options.useMrrt,dpop:this.dpop},e),{scope:a||e.scope}),this.worker),c=await this._verifyIdToken(s.id_token,o,i);if("authorization_code"===e.grant_type){let e=await this._getIdTokenFromCache();(null==(r=null==(n=null==e?void 0:e.decodedToken)?void 0:n.claims)?void 0:r.sub)&&e.decodedToken.claims.sub!==c.claims.sub&&(await this.cacheManager.clear(this.options.clientId),this.userCache.remove("@@user@@"))}return await this._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},s),{decodedToken:c,scope:e.scope,audience:e.audience||"default"}),s.scope?{oauthTokenScope:s.scope}:null),{client_id:this.options.clientId})),this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this._processOrgHint(i||c.claims.org_id),Object.assign(Object.assign({},s),{decodedToken:c})}async exchangeToken(e){return this._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:e.subject_token,subject_token_type:e.subject_token_type,scope:ew(this.scope,e.scope,e.audience||this.options.authorizationParams.audience),audience:e.audience||this.options.authorizationParams.audience,organization:e.organization||this.options.authorizationParams.organization})}_assertDpop(e){if(!e)throw Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(e){return this._assertDpop(this.dpop),this.dpop.getNonce(e)}setDpopNonce(e,t){return this._assertDpop(this.dpop),this.dpop.setNonce(e,t)}generateDpopProof(e){return this._assertDpop(this.dpop),this.dpop.generateProof(e)}createFetcher(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new eG(e,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:e=>{var t;return this.getTokenSilently({authorizationParams:{scope:null==(t=null==e?void 0:e.scope)?void 0:t.join(" "),audience:null==e?void 0:e.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(e.dpopNonceId),setDpopNonce:t=>this.setDpopNonce(t,e.dpopNonceId),generateDpopProof:e=>this.generateDpopProof(e)})}async connectAccountWithRedirect(e){let{openUrl:t,appState:n,connection:r,scopes:o,authorization_params:i,redirectUri:a=this.options.authorizationParams.redirect_uri||window.location.origin}=e;if(!r)throw Error("connection is required");let s=btoa(F()),c=F(),l=Y(await B(c)),{connect_uri:u,connect_params:d,auth_session:h}=await this.myAccountApi.connectAccount({connection:r,scopes:o,redirect_uri:a,state:s,code_challenge:l,code_challenge_method:"S256",authorization_params:i});this.transactionManager.create({state:s,code_verifier:c,auth_session:h,redirect_uri:a,appState:n,connection:r,response_type:eC.ConnectCode});let p=new URL(u);p.searchParams.set("ticket",d.ticket),t?await t(p.toString()):window.location.assign(p)}}async function oP(e){let t=new oT(e);return await t.checkSession(),t}window.env={APP_URL:"http://localhost:38500",API_URL:"http://localhost:35500",AUTH0_DOMAIN:"part1.au.auth0.com",CLIENT_ID:"AQxeCQYm6zi4F46dQM3pfp7Lb4kcEY6i"};let oR=window.env.AUTH0_DOMAIN,oI=window.env.CLIENT_ID,oO=window.env.APP_URL;window.auth0Client=await oP({domain:oR,clientId:oI,authorizationParams:{redirect_uri:oO}}),async function(){window.addEventListener("hashchange",()=>{b()}),window.addEventListener("load",()=>{sessionStorage.getItem("reload")||(b(),sessionStorage.setItem("reload","true"))}),sessionStorage.getItem("reload")&&(sessionStorage.setItem("reload","true"),await b())}();
//# sourceMappingURL=spa-app.fd9a8bb8.js.map
